<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Sterrenhemel — Astronomie & Astrologie</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..800;1,9..40,300..800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
<style>
:root{
  --bg:#06080f;--bg2:#0c1022;--bg3:#131833;
  --surface:rgba(19,24,51,.7);--glass:rgba(19,24,51,.45);--glass-bd:rgba(148,163,184,.12);
  --tx:#e2e8f0;--tx2:#94a3b8;--tx3:#64748b;
  --gold:#fbbf24;--blue:#3b82f6;--purple:#a855f7;--red:#ef4444;--green:#22c55e;--cyan:#06b6d4;
  --r:14px;--rs:8px;--font:'DM Sans',system-ui,sans-serif;--mono:'Space Mono',monospace;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--tx);line-height:1.6;min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(148,163,184,.2);border-radius:10px}
a{color:var(--blue);text-decoration:none}
.mi{font-family:'Material Icons Round';font-size:20px;vertical-align:-4px}

/* Stars background */
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 50%,rgba(59,130,246,.06) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(168,85,247,.05) 0%,transparent 50%),radial-gradient(ellipse at 50% 80%,rgba(251,191,36,.03) 0%,transparent 50%);pointer-events:none;z-index:0}

/* Top bar */
.top{position:sticky;top:0;z-index:100;background:rgba(6,8,15,.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--glass-bd);padding:0 20px}
.top-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;height:50px;gap:12px}
.logo{font-weight:700;font-size:15px;display:flex;align-items:center;gap:7px;color:var(--gold)}
.logo .mi{font-size:22px}
.spacer{flex:1}

/* Tabs */
.tabs{display:flex;gap:2px}
.tab{padding:6px 14px;border-radius:var(--rs);font:600 12px var(--font);color:var(--tx3);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;border:none;background:none}
.tab:hover{color:var(--tx);background:rgba(255,255,255,.04)}
.tab.active{color:var(--gold);background:rgba(251,191,36,.08)}
.tab .mi{font-size:16px}

/* Panels */
.wrap{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:1}
.panel{display:none}.panel.active{display:block}
.card{background:var(--surface);backdrop-filter:blur(12px);border:1px solid var(--glass-bd);border-radius:var(--r);padding:20px;margin-bottom:16px}
.card h2{font-size:16px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card h3{font-size:13px;font-weight:600;margin:12px 0 6px;color:var(--gold)}
.row{display:flex;gap:16px;flex-wrap:wrap}
.col{flex:1;min-width:280px}

/* Star chart */
#skyCanvas{width:100%;border-radius:var(--r);cursor:grab;background:radial-gradient(circle,#0a1025 0%,#050810 100%)}
#skyCanvas:active{cursor:grabbing}
.sky-controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;align-items:center}
.sky-controls label{font:500 11px var(--font);color:var(--tx2)}
.sky-controls input,.sky-controls select{padding:5px 8px;background:var(--bg2);border:1px solid var(--glass-bd);border-radius:var(--rs);color:var(--tx);font:12px var(--mono);min-width:0}
.sky-controls input[type="range"]{width:120px;accent-color:var(--gold)}
.sky-info{display:flex;gap:16px;margin-top:8px;flex-wrap:wrap}
.sky-info span{font:11px var(--mono);color:var(--tx3)}

/* Zodiac */
.zodiac-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}
.zodiac-card{background:var(--glass);border:1px solid var(--glass-bd);border-radius:var(--rs);padding:10px;text-align:center;cursor:pointer;transition:all .2s}
.zodiac-card:hover{border-color:var(--gold);transform:translateY(-2px)}
.zodiac-card.active{border-color:var(--gold);background:rgba(251,191,36,.06)}
.zodiac-symbol{font-size:28px;margin-bottom:4px}
.zodiac-name{font:600 12px var(--font)}
.zodiac-dates{font:10px var(--mono);color:var(--tx3);margin-top:2px}

/* Horoscope form */
.form-row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;align-items:end}
.form-group{display:flex;flex-direction:column;gap:3px}
.form-group label{font:500 10px var(--font);color:var(--tx3);text-transform:uppercase;letter-spacing:.5px}
.form-group input,.form-group select{padding:8px 10px;background:var(--bg2);border:1px solid var(--glass-bd);border-radius:var(--rs);color:var(--tx);font:13px var(--mono)}
.btn{padding:8px 16px;border-radius:var(--rs);font:600 12px var(--font);cursor:pointer;border:none;transition:all .2s;display:flex;align-items:center;gap:5px}
.btn-gold{background:linear-gradient(135deg,rgba(251,191,36,.2),rgba(251,191,36,.1));color:var(--gold);border:1px solid rgba(251,191,36,.25)}
.btn-gold:hover{background:linear-gradient(135deg,rgba(251,191,36,.3),rgba(251,191,36,.15));transform:translateY(-1px)}

/* Result panel */
.result-box{background:var(--bg2);border:1px solid var(--glass-bd);border-radius:var(--rs);padding:14px;margin-top:12px}
.result-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.03);font-size:12px}
.result-row:last-child{border:none}
.result-label{color:var(--tx3);display:flex;align-items:center;gap:5px}
.result-val{font:600 12px var(--mono);color:var(--tx)}
.result-val.gold{color:var(--gold)}
.result-val.purple{color:var(--purple)}

/* Planets table */
.planet-table{width:100%;border-collapse:collapse;font-size:12px}
.planet-table th{text-align:left;padding:6px 8px;color:var(--tx3);font:600 10px var(--font);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--glass-bd)}
.planet-table td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.02)}
.planet-table tr:hover{background:rgba(255,255,255,.02)}
.planet-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:-1px}
.retro{color:var(--red);font:700 9px var(--mono)}

/* Moon phase */
.moon-container{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
.moon-visual{width:100px;height:100px;position:relative;flex-shrink:0}
.moon-info{flex:1;min-width:150px}

/* Precessie */
.precessie-viz{text-align:center;padding:20px}
.shift-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:12px}
.shift-table th{padding:6px 8px;background:rgba(251,191,36,.06);color:var(--gold);font:600 10px var(--font);text-transform:uppercase;letter-spacing:.5px}
.shift-table td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.03);text-align:center}
.shift-table td:first-child{text-align:left}
.shift-diff{color:var(--red);font-weight:600}

/* Deep sky badges */
.deep-sky-badge{position:absolute;pointer-events:none;border-radius:50%;animation:pulse-glow 2s ease-in-out infinite}
@keyframes pulse-glow{0%,100%{opacity:0.6;transform:scale(1)}50%{opacity:1;transform:scale(1.2)}}

/* Tooltip */
.star-tooltip{position:fixed;z-index:200;pointer-events:none;background:rgba(6,8,15,.96);backdrop-filter:blur(20px);border:1px solid rgba(251,191,36,.25);border-radius:var(--r);padding:14px 16px;max-width:320px;opacity:0;transition:opacity .15s;font-size:12px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
.star-tooltip.visible{opacity:1}
.star-tooltip .tt-name{font:700 15px var(--font);color:var(--gold);margin-bottom:6px;display:flex;align-items:center;gap:6px}
.star-tooltip .tt-type{font:10px var(--mono);color:var(--tx3);margin-bottom:8px}
.star-tooltip .tt-stats{display:grid;grid-template-columns:auto 1fr;gap:2px 10px;margin-bottom:8px;font:10px var(--mono)}
.star-tooltip .tt-stat-label{color:var(--tx3)}
.star-tooltip .tt-stat-val{color:var(--tx)}
.star-tooltip .tt-divider{height:1px;background:rgba(148,163,184,.1);margin:6px 0}
.star-tooltip .tt-fact{font:11px var(--font);color:var(--tx2);line-height:1.5;padding:6px 8px;background:rgba(251,191,36,.04);border-radius:var(--rs);border-left:2px solid rgba(251,191,36,.3)}

/* Natal chart */
#natalChartCanvas{display:block;margin:0 auto;max-width:100%}
.natal-wrap{display:flex;gap:16px;flex-wrap:wrap;margin-top:16px}
.natal-chart-col{flex:1;min-width:300px;display:flex;justify-content:center;align-items:flex-start}
.natal-info-col{flex:1;min-width:280px}

/* Compatibility */
.compat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:6px;margin-top:10px}
.compat-card{background:var(--glass);border:1px solid var(--glass-bd);border-radius:var(--rs);padding:8px;text-align:center;transition:all .2s}
.compat-card.best{border-color:var(--gold);background:rgba(251,191,36,.08)}
.compat-card .compat-symbol{font-size:22px}
.compat-card .compat-name{font:600 11px var(--font);margin-top:2px}
.compat-card .compat-score{font:700 10px var(--mono);margin-top:3px}
.compat-stars{color:var(--gold);font-size:10px;letter-spacing:1px}

/* Profile card */
.profile-card{background:linear-gradient(135deg,rgba(251,191,36,.06),rgba(168,85,247,.06));border:1px solid rgba(251,191,36,.15);border-radius:var(--r);padding:16px;margin-top:12px}
.profile-header{display:flex;gap:16px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
.profile-symbol{font-size:48px;line-height:1}
.profile-titles h3{font:700 18px var(--font);color:var(--gold);margin:0}
.profile-titles p{font:12px var(--font);color:var(--tx2);margin:2px 0 0}
.trait-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}
.trait-tag{padding:3px 10px;border-radius:20px;font:500 10px var(--font);border:1px solid}
.trait-tag.strength{color:var(--green);border-color:rgba(34,197,94,.25);background:rgba(34,197,94,.06)}
.trait-tag.weakness{color:var(--red);border-color:rgba(239,68,68,.2);background:rgba(239,68,68,.05)}

@media(max-width:768px){
  .tabs{overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}
  .tab{font-size:11px;padding:5px 10px}
  .row{flex-direction:column}
  .col{min-width:0}
  .sky-controls{gap:4px}
  .zodiac-grid{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>
<body>

<div class="top">
  <div class="top-inner">
    <div class="logo"><span class="mi">auto_awesome</span> Sterrenhemel</div>
    <div class="spacer"></div>
    <div class="tabs">
      <button class="tab active" onclick="showPanel('sky')"><span class="mi">nightlight</span> Sterrenkaart</button>
      <button class="tab" onclick="showPanel('horoscope')"><span class="mi">stars</span> Horoscoop</button>
      <button class="tab" onclick="showPanel('precessie')"><span class="mi">public</span> Precessie</button>
      <button class="tab" onclick="showPanel('planeten')"><span class="mi">rocket</span> Planeten</button>
    </div>
  </div>
</div>

<div class="wrap">

<!-- ============================================================ -->
<!-- PANEL 1: STERRENKAART -->
<!-- ============================================================ -->
<div class="panel active" id="panelSky">
  <div class="card">
    <h2><span class="mi" style="color:var(--gold)">nightlight</span> Interactieve Sterrenkaart</h2>
    <div class="sky-controls">
      <div class="form-group">
        <label>Datum & tijd</label>
        <input type="datetime-local" id="skyDate" onchange="updateSky()">
      </div>
      <div class="form-group">
        <label>Locatie</label>
        <select id="skyLocation" onchange="updateSky()">
          <option value="52.37,4.90">Amsterdam</option>
          <option value="52.09,5.12">Utrecht</option>
          <option value="53.22,6.57">Groningen</option>
          <option value="50.85,5.69">Maastricht</option>
          <option value="51.44,5.47">Eindhoven</option>
          <option value="51.92,4.48">Rotterdam</option>
        </select>
      </div>
      <div class="form-group">
        <label>Zoom</label>
        <input type="range" id="skyZoom" min="0.5" max="3" step="0.1" value="1" oninput="updateSky()">
      </div>
      <button class="btn btn-gold" onclick="skyNow()"><span class="mi" style="font-size:14px">schedule</span> Nu</button>
    </div>
    <canvas id="skyCanvas" width="1000" height="600"></canvas>
    <div class="star-tooltip" id="starTooltip"></div>
    <div class="sky-info">
      <span id="skyInfoTime"></span>
      <span id="skyInfoLoc"></span>
      <span id="skyInfoSun"></span>
      <span id="skyInfoMoon"></span>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- PANEL 2: HOROSCOOP -->
<!-- ============================================================ -->
<div class="panel" id="panelHoroscope">
  <div class="row">
    <div class="col">
      <div class="card">
        <h2><span class="mi" style="color:var(--purple)">stars</span> Geboortehoroscoop</h2>
        <p style="font-size:12px;color:var(--tx2);margin-bottom:12px">Bereken je sterrenbeeld op basis van je geboortedatum. We laten zien wat de westerse astrologie zegt (tropische dierenriem) en wat astronomisch klopt (siderische dierenriem met precessie).</p>
        <div class="form-row">
          <div class="form-group">
            <label>Geboortedatum</label>
            <input type="date" id="birthDate" value="1990-06-15">
          </div>
          <div class="form-group">
            <label>Geboortetijd</label>
            <input type="time" id="birthTime" value="12:00">
          </div>
          <div class="form-group">
            <label>Geboorteplaats</label>
            <select id="birthPlace">
              <option value="52.37,4.90">Amsterdam</option>
              <option value="52.09,5.12">Utrecht</option>
              <option value="53.22,6.57">Groningen</option>
              <option value="50.85,5.69">Maastricht</option>
              <option value="51.44,5.47">Eindhoven</option>
              <option value="51.92,4.48">Rotterdam</option>
              <option value="52.22,6.90">Enschede</option>
              <option value="51.81,4.67">Dordrecht</option>
            </select>
          </div>
          <button class="btn btn-gold" onclick="calcHoroscope()"><span class="mi" style="font-size:14px">calculate</span> Bereken</button>
        </div>
        <div id="horoscopeResult"></div>
        <div id="natalChartSection" style="display:none">
          <div class="natal-wrap">
            <div class="natal-chart-col">
              <canvas id="natalChartCanvas" width="500" height="500"></canvas>
            </div>
            <div class="natal-info-col" id="natalInfo"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col" style="max-width:380px">
      <div class="card">
        <h2><span class="mi" style="color:var(--gold)">grid_view</span> Dierenriem</h2>
        <div class="zodiac-grid" id="zodiacGrid"></div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- PANEL 3: PRECESSIE -->
<!-- ============================================================ -->
<div class="panel" id="panelPrecessie">
  <div class="card">
    <h2><span class="mi" style="color:var(--cyan)">public</span> Precessie van de Aardas</h2>
    <p style="font-size:12px;color:var(--tx2);margin-bottom:16px">
      De aardas maakt in ~26.000 jaar een volledige cirkel (precessie). Hierdoor verschuift het lentepunt langzaam door de sterrenbeelden.
      Rond het jaar 0 klopte de tropische dierenriem nog met de werkelijke sterrenbeelden. Sindsdien is alles ~28&deg; opgeschoven.
      Je astrologische sterrenbeeld is dus waarschijnlijk niet het sterrenbeeld waar de zon werkelijk in stond bij je geboorte!
    </p>
    <div class="row">
      <div class="col">
        <div class="precessie-viz">
          <canvas id="precessCanvas" width="400" height="400" style="max-width:100%;border-radius:var(--r)"></canvas>
          <div style="margin-top:12px">
            <label style="font:500 11px var(--font);color:var(--tx2)">Jaar: <span id="precessYear">2024</span></label><br>
            <input type="range" id="precessSlider" min="-2000" max="4000" value="2024" step="10" oninput="updatePrecess()" style="width:100%;accent-color:var(--gold);margin-top:6px">
          </div>
          <div style="font:11px var(--mono);color:var(--tx3);margin-top:6px">
            Verschuiving: <span id="precessShift" style="color:var(--gold)">28.0&deg;</span> | Lentepunt in: <span id="precessSign" style="color:var(--purple)">Vissen</span>
          </div>
        </div>
      </div>
      <div class="col">
        <h3>Tropisch vs. Siderisch sterrenbeeld</h3>
        <p style="font-size:11px;color:var(--tx2);margin-bottom:8px">De westerse astrologie gebruikt de <b>tropische</b> dierenriem: vaste datums die rond 150 n.Chr. door Ptolemaeus zijn vastgelegd.
        De <b>siderische</b> (astronomische) dierenriem volgt de werkelijke posities van de sterrenbeelden aan de hemel, gebaseerd op IAU-grenzen.</p>
        <table class="shift-table" id="shiftTable"></table>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================ -->
<!-- PANEL 4: PLANETEN -->
<!-- ============================================================ -->
<div class="panel" id="panelPlaneten">
  <div class="row">
    <div class="col">
      <div class="card">
        <h2><span class="mi" style="color:var(--blue)">rocket</span> Planeetposities</h2>
        <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center">
          <input type="datetime-local" id="planetDate" onchange="updatePlanets()" style="padding:5px 8px;background:var(--bg2);border:1px solid var(--glass-bd);border-radius:var(--rs);color:var(--tx);font:12px var(--mono)">
          <button class="btn btn-gold" onclick="planetNow()"><span class="mi" style="font-size:14px">schedule</span> Nu</button>
        </div>
        <table class="planet-table" id="planetTable">
          <thead><tr><th>Planeet</th><th>Sterrenbeeld</th><th>RA</th><th>Dec</th><th>Status</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div class="col" style="max-width:320px">
      <div class="card">
        <h2><span class="mi" style="color:var(--tx2)">dark_mode</span> Maanfase</h2>
        <div class="moon-container">
          <div class="moon-visual"><canvas id="moonCanvas" width="100" height="100"></canvas></div>
          <div class="moon-info">
            <div style="font:700 16px var(--font);color:var(--tx)" id="moonPhaseName">Volle maan</div>
            <div style="font:12px var(--mono);color:var(--tx2)" id="moonPhaseAge">Dag 14.2</div>
            <div style="font:11px var(--mono);color:var(--tx3)" id="moonIllum">Verlicht: 98%</div>
            <div style="font:11px var(--mono);color:var(--tx3);margin-top:6px" id="moonRiseSet"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <h2><span class="mi" style="color:var(--gold)">event</span> Komende Gebeurtenissen</h2>
        <div id="eventsList" style="font-size:12px"></div>
      </div>
    </div>
  </div>
</div>

</div><!-- /wrap -->

<script>
// ============================================================
// DATA: Sterren, sterrenbeelden, dierenriem
// ============================================================

var ZODIAC = [
  {id:'aries',symbol:'\u2648',name:'Ram',nameEn:'Aries',element:'Vuur',quality:'Kardinaal',ruler:'Mars',
   tropisch:'21 mrt \u2013 19 apr',siderisch:'18 apr \u2013 13 mei',tropStart:[3,21],tropEnd:[4,19],siderStart:[4,18],siderEnd:[5,13],color:'#ef4444',
   desc:'Energiek, moedig en competitief. De Ram is een geboren leider die niet bang is om nieuwe paden te bewandelen.',
   ascDesc:'Met Ram als ascendant straal je daadkracht en energie uit. Mensen zien je als direct, sportief en vol pit.',
   strengths:['Moedig','Vastberaden','Zelfverzekerd','Enthousiast','Eerlijk'],
   weaknesses:['Ongeduldig','Impulsief','Kort lontje','Competitief'],
   compatible:['leo','sagittarius','gemini','aquarius'],bestMatch:'leo',
   loveStyle:'Gepassioneerd en direct \u2014 de Ram valt hard en snel.'},

  {id:'taurus',symbol:'\u2649',name:'Stier',nameEn:'Taurus',element:'Aarde',quality:'Vast',ruler:'Venus',
   tropisch:'20 apr \u2013 20 mei',siderisch:'14 mei \u2013 19 jun',tropStart:[4,20],tropEnd:[5,20],siderStart:[5,14],siderEnd:[6,19],color:'#22c55e',
   desc:'Betrouwbaar, geduldig en praktisch. De Stier houdt van comfort, schoonheid en de fijne dingen des levens.',
   ascDesc:'Met Stier als ascendant kom je rustig en betrouwbaar over. Je houdt van luxe, schoonheid en stabiliteit.',
   strengths:['Betrouwbaar','Geduldig','Praktisch','Toegewijd','Sensueel'],
   weaknesses:['Koppig','Bezitterig','Lui','Materialistisch'],
   compatible:['virgo','capricorn','cancer','pisces'],bestMatch:'virgo',
   loveStyle:'Trouw en sensueel \u2014 de Stier bouwt aan een liefde die eeuwig duurt.'},

  {id:'gemini',symbol:'\u264A',name:'Tweelingen',nameEn:'Gemini',element:'Lucht',quality:'Beweeglijk',ruler:'Mercurius',
   tropisch:'21 mei \u2013 20 jun',siderisch:'20 jun \u2013 20 jul',tropStart:[5,21],tropEnd:[6,20],siderStart:[6,20],siderEnd:[7,20],color:'#fbbf24',
   desc:'Nieuwsgierig, aanpasbaar en communicatief. Tweelingen zijn de sociale vlinders van de dierenriem.',
   ascDesc:'Met Tweelingen als ascendant ben je vlot, geestig en nieuwsgierig. Je maakt makkelijk contact.',
   strengths:['Communicatief','Aanpasbaar','Slim','Geestig','Veelzijdig'],
   weaknesses:['Oppervlakkig','Onrustig','Besluiteloos','Wispelturig'],
   compatible:['libra','aquarius','aries','leo'],bestMatch:'aquarius',
   loveStyle:'Speels en intellectueel \u2014 Tweelingen flirten met woorden en idee\u00ebn.'},

  {id:'cancer',symbol:'\u264B',name:'Kreeft',nameEn:'Cancer',element:'Water',quality:'Kardinaal',ruler:'Maan',
   tropisch:'21 jun \u2013 22 jul',siderisch:'21 jul \u2013 9 aug',tropStart:[6,21],tropEnd:[7,22],siderStart:[7,21],siderEnd:[8,9],color:'#94a3b8',
   desc:'Zorgzaam, intu\u00eftief en beschermend. De Kreeft is diep verbonden met huis, familie en emotie.',
   ascDesc:'Met Kreeft als ascendant ben je warm, verzorgend en emotioneel intelligent. Je voelt sferen feilloos aan.',
   strengths:['Zorgzaam','Loyaal','Intu\u00eftief','Beschermend','Empathisch'],
   weaknesses:['Humeurig','Clingy','Overgevoelig','Wantrouwend'],
   compatible:['scorpio','pisces','taurus','virgo'],bestMatch:'scorpio',
   loveStyle:'Diep en verzorgend \u2014 de Kreeft geeft alles voor de mensen van wie ze houdt.'},

  {id:'leo',symbol:'\u264C',name:'Leeuw',nameEn:'Leo',element:'Vuur',quality:'Vast',ruler:'Zon',
   tropisch:'23 jul \u2013 22 aug',siderisch:'10 aug \u2013 15 sep',tropStart:[7,23],tropEnd:[8,22],siderStart:[8,10],siderEnd:[9,15],color:'#f97316',
   desc:'Creatief, hartstochtelijk en grootmoedig. De Leeuw straalt van nature en trekt de aandacht.',
   ascDesc:'Met Leeuw als ascendant ben je charismatisch en theatraal. Je vult elke kamer die je binnenloopt.',
   strengths:['Creatief','Genereus','Warm','Charismatisch','Zelfverzekerd'],
   weaknesses:['Arrogant','Ijdel','Dominant','Aandacht-zoekend'],
   compatible:['aries','sagittarius','gemini','libra'],bestMatch:'aries',
   loveStyle:'Groots en royaal \u2014 de Leeuw wil aanbeden worden en geeft dat tien keer terug.'},

  {id:'virgo',symbol:'\u264D',name:'Maagd',nameEn:'Virgo',element:'Aarde',quality:'Beweeglijk',ruler:'Mercurius',
   tropisch:'23 aug \u2013 22 sep',siderisch:'16 sep \u2013 30 okt',tropStart:[8,23],tropEnd:[9,22],siderStart:[9,16],siderEnd:[10,30],color:'#a3e635',
   desc:'Analytisch, behulpzaam en bescheiden. De Maagd let op details en streeft naar perfectie.',
   ascDesc:'Met Maagd als ascendant kom je georganiseerd en bescheiden over. Je oog voor detail valt op.',
   strengths:['Analytisch','Behulpzaam','Precies','Bescheiden','Praktisch'],
   weaknesses:['Kritisch','Perfectionistisch','Tobberig','Te bescheiden'],
   compatible:['taurus','capricorn','cancer','scorpio'],bestMatch:'taurus',
   loveStyle:'Attent en dienstbaar \u2014 de Maagd toont liefde door te doen, niet te zeggen.'},

  {id:'libra',symbol:'\u264E',name:'Weegschaal',nameEn:'Libra',element:'Lucht',quality:'Kardinaal',ruler:'Venus',
   tropisch:'23 sep \u2013 22 okt',siderisch:'31 okt \u2013 22 nov',tropStart:[9,23],tropEnd:[10,22],siderStart:[10,31],siderEnd:[11,22],color:'#ec4899',
   desc:'Harmonieus, diplomatiek en rechtvaardig. De Weegschaal zoekt balans in alles.',
   ascDesc:'Met Weegschaal als ascendant ben je charmant en diplomatiek. Je hebt een aangeboren gevoel voor stijl.',
   strengths:['Diplomatiek','Eerlijk','Sociaal','Charmant','Esthetisch'],
   weaknesses:['Besluiteloos','Conflictvermijdend','Afhankelijk','IJdel'],
   compatible:['gemini','aquarius','leo','sagittarius'],bestMatch:'gemini',
   loveStyle:'Romantisch en verfijnd \u2014 de Weegschaal gelooft in de perfecte partner.'},

  {id:'scorpio',symbol:'\u264F',name:'Schorpioen',nameEn:'Scorpio',element:'Water',quality:'Vast',ruler:'Pluto',
   tropisch:'23 okt \u2013 21 nov',siderisch:'23 nov \u2013 29 nov',tropStart:[10,23],tropEnd:[11,21],siderStart:[11,23],siderEnd:[11,29],color:'#991b1b',
   desc:'Intens, vastberaden en mysterieus. De Schorpioen gaat tot de kern van alles.',
   ascDesc:'Met Schorpioen als ascendant heb je een magnetische uitstraling. Je blik is doordringend en intens.',
   strengths:['Vastberaden','Moedig','Loyaal','Intuïtief','Gepassioneerd'],
   weaknesses:['Jaloers','Geheimzinnig','Wraakzuchtig','Controlerend'],
   compatible:['cancer','pisces','virgo','capricorn'],bestMatch:'cancer',
   loveStyle:'Alles of niets \u2014 de Schorpioen bemint met ongekende diepte en intensiteit.'},

  {id:'sagittarius',symbol:'\u2650',name:'Boogschutter',nameEn:'Sagittarius',element:'Vuur',quality:'Beweeglijk',ruler:'Jupiter',
   tropisch:'22 nov \u2013 21 dec',siderisch:'17 dec \u2013 19 jan',tropStart:[11,22],tropEnd:[12,21],siderStart:[12,17],siderEnd:[1,19],color:'#7c3aed',
   desc:'Avontuurlijk, optimistisch en filosofisch. De Boogschutter zoekt kennis en vrijheid.',
   ascDesc:'Met Boogschutter als ascendant straal je optimisme en avontuur uit. Je bent altijd klaar voor iets nieuws.',
   strengths:['Optimistisch','Eerlijk','Avontuurlijk','Filosofisch','Grappig'],
   weaknesses:['Tactloos','Ongeduldig','Onverantwoordelijk','Rusteloos'],
   compatible:['aries','leo','libra','aquarius'],bestMatch:'aries',
   loveStyle:'Vrij en avontuurlijk \u2014 de Boogschutter wil een partner die mee op reis gaat.'},

  {id:'capricorn',symbol:'\u2651',name:'Steenbok',nameEn:'Capricorn',element:'Aarde',quality:'Kardinaal',ruler:'Saturnus',
   tropisch:'22 dec \u2013 19 jan',siderisch:'20 jan \u2013 15 feb',tropStart:[12,22],tropEnd:[1,19],siderStart:[1,20],siderEnd:[2,15],color:'#6b7280',
   desc:'Ambitieus, gedisciplineerd en verantwoordelijk. De Steenbok klimt gestaag naar de top.',
   ascDesc:'Met Steenbok als ascendant kom je serieus en ambitieus over. Mensen vertrouwen op jouw stabiliteit.',
   strengths:['Ambitieus','Gedisciplineerd','Geduldig','Verantwoordelijk','Strategisch'],
   weaknesses:['Pessimistisch','Rigide','Werkverslaafd','Emotioneel gesloten'],
   compatible:['taurus','virgo','scorpio','pisces'],bestMatch:'taurus',
   loveStyle:'Stabiel en loyaal \u2014 de Steenbok bouwt aan een relatie als aan een carri\u00e8re: met toewijding.'},

  {id:'aquarius',symbol:'\u2652',name:'Waterman',nameEn:'Aquarius',element:'Lucht',quality:'Vast',ruler:'Uranus',
   tropisch:'20 jan \u2013 18 feb',siderisch:'16 feb \u2013 11 mrt',tropStart:[1,20],tropEnd:[2,18],siderStart:[2,16],siderEnd:[3,11],color:'#06b6d4',
   desc:'Onafhankelijk, origineel en humanitair. De Waterman denkt vooruit en wil de wereld verbeteren.',
   ascDesc:'Met Waterman als ascendant ben je excentriek en vooruitstrevend. Je valt op door je unieke stijl.',
   strengths:['Origineel','Onafhankelijk','Humanitair','Intellectueel','Visionair'],
   weaknesses:['Afstandelijk','Koppig','Onvoorspelbaar','Emotioneel onbereikbaar'],
   compatible:['gemini','libra','aries','sagittarius'],bestMatch:'gemini',
   loveStyle:'Intellectueel en onconventioneel \u2014 de Waterman wil een beste vriend \u00e9n minnaar.'},

  {id:'pisces',symbol:'\u2653',name:'Vissen',nameEn:'Pisces',element:'Water',quality:'Beweeglijk',ruler:'Neptunus',
   tropisch:'19 feb \u2013 20 mrt',siderisch:'12 mrt \u2013 17 apr',tropStart:[2,19],tropEnd:[3,20],siderStart:[3,12],siderEnd:[4,17],color:'#2563eb',
   desc:'Empathisch, creatief en dromerig. Vissen voelen de emoties van anderen en leven in een rijke innerlijke wereld.',
   ascDesc:'Met Vissen als ascendant heb je een dromerige, zachte uitstraling. Je bent artistiek en invoelend.',
   strengths:['Empathisch','Creatief','Wijs','Zachtaardig','Intu\u00eftief'],
   weaknesses:['Naïef','Ontwijkend','Overgevoelig','Slachtoffer-rol'],
   compatible:['cancer','scorpio','taurus','capricorn'],bestMatch:'cancer',
   loveStyle:'Dromerig en opofferend \u2014 de Vissen geven zich volledig over aan de liefde.'}
];

// Ecliptic longitude boundaries for tropical zodiac (0=Aries vernal equinox)
var TROPICAL_BOUNDS = [0,30,60,90,120,150,180,210,240,270,300,330,360];
// Approximate sidereal offset (ayanamsa): ~24.1 degrees in 2024, growing ~1 degree per 72 years
function getAyanamsa(year){ return 24.1 + (year - 2024) / 72; }

// Bright stars catalog: [name, RA hours, Dec degrees, magnitude]
var BRIGHT_STARS = [
  ['Sirius',6.752,-16.72,-1.46],['Canopus',6.399,-52.70,-0.74],['Arcturus',14.261,19.18,-0.05],
  ['Vega',18.616,38.78,0.03],['Capella',5.278,46.00,0.08],['Rigel',5.242,-8.20,0.13],
  ['Procyon',7.655,5.22,0.34],['Betelgeuse',5.920,7.41,0.42],['Altair',19.846,8.87,0.76],
  ['Aldebaran',4.599,16.51,0.86],['Antares',16.490,-26.43,0.96],['Spica',13.420,-11.16,0.97],
  ['Pollux',7.755,28.03,1.14],['Fomalhaut',22.961,-29.62,1.16],['Deneb',20.690,45.28,1.25],
  ['Regulus',10.140,11.97,1.35],['Castor',7.577,31.89,1.58],['Bellatrix',5.419,6.35,1.64],
  ['Alnilam',5.603,-1.20,1.69],['Alnitak',5.679,-1.94,1.77],['Mintaka',5.533,-0.30,2.23],
  ['Dubhe',11.062,61.75,1.79],['Merak',11.031,56.38,2.37],['Polaris',2.530,89.26,1.98],
  ['Mizar',13.399,54.93,2.27],['Alkaid',13.793,49.31,1.86],
  // Zodiac constellation key stars
  ['Hamal',2.120,23.46,2.00],['Sheratan',1.911,20.81,2.64], // Aries
  ['Elnath',5.438,28.61,1.65], // Taurus
  ['Alhena',6.629,16.40,1.93],['Wasat',7.335,21.98,3.53], // Gemini
  ['Acubens',8.975,11.86,4.26], // Cancer
  ['Algieba',10.333,19.84,2.28],['Denebola',11.818,14.57,2.14], // Leo
  ['Vindemiatrix',13.036,10.96,2.83],['Zavijava',11.845,1.76,3.61], // Virgo
  ['Zubenelgenubi',14.848,-16.04,2.75],['Zubeneschamali',15.283,-9.38,2.61], // Libra
  ['Dschubba',16.006,-22.62,2.32],['Shaula',17.560,-37.10,1.63], // Scorpius
  ['Kaus Australis',18.403,-34.38,1.85],['Nunki',18.921,-26.30,2.02], // Sagittarius
  ['Dabih',20.350,-14.78,3.08],['Algedi',20.294,-12.51,3.57], // Capricorn
  ['Sadalmelik',22.097,-0.32,2.96],['Sadalsuud',21.526,-5.57,2.91], // Aquarius
  ['Alrescha',2.034,2.76,3.82], // Pisces
];

// Star facts for tooltips: {name: {dist, constellation, spectral, fact}}
var STAR_FACTS = {
  'Sirius':     {dist:'8.6 lj', constellation:'Grote Hond', spectral:'A1V', fact:'De helderste ster aan de nachtelijke hemel. De oude Egyptenaren gebruikten Sirius om het begin van de Nijloverstroming te voorspellen.'},
  'Canopus':    {dist:'310 lj', constellation:'Kiel', spectral:'F0II', fact:'Op twee na helderste ster. Ruimteschepen gebruiken Canopus als referentiepunt voor navigatie.'},
  'Arcturus':   {dist:'37 lj', constellation:'Ossenhoeder', spectral:'K1.5III', fact:'Een rode reus die 25x groter is dan de zon. In 1933 werd het licht van Arcturus gebruikt om de Wereldtentoonstelling in Chicago te openen.'},
  'Vega':       {dist:'25 lj', constellation:'Lier', spectral:'A0V', fact:'Was 14.000 jaar geleden de Poolster en zal dat over 12.000 jaar weer zijn. E\u0301\u0301\u0301n van de eerste sterren die gefotografeerd werd (1850).'},
  'Capella':    {dist:'43 lj', constellation:'Voerman', spectral:'G8III', fact:'Eigenlijk een systeem van 4 sterren! De naam betekent "geitje" in het Latijn.'},
  'Rigel':      {dist:'860 lj', constellation:'Orion', spectral:'B8Ia', fact:'Een blauwe superreus die 120.000x zo helder is als de zon. De linkervoet van Orion.'},
  'Procyon':    {dist:'11.5 lj', constellation:'Kleine Hond', spectral:'F5IV', fact:'E\u0301\u0301\u0301n van onze dichtstbijzijnde buren. De naam betekent "v\u00f3\u00f3r de hond" \u2014 hij komt net voor Sirius op.'},
  'Betelgeuse': {dist:'700 lj', constellation:'Orion', spectral:'M1Ia', fact:'Een rode superreus die zo groot is dat hij tot voorbij Mars zou reiken. Kan elk moment als supernova exploderen!'},
  'Altair':     {dist:'17 lj', constellation:'Arend', spectral:'A7V', fact:'Draait z\u00f3 snel om zijn as (elke 10 uur) dat hij aan de evenaar uitpuilt. In het Chinese sterrenverhaal is Altair de Koeherder.'},
  'Aldebaran':  {dist:'65 lj', constellation:'Stier', spectral:'K5III', fact:'Het "oog van de stier". Rode reus die 44x de diameter van de zon heeft.'},
  'Antares':    {dist:'550 lj', constellation:'Schorpioen', spectral:'M1Ib', fact:'De naam betekent "rivaal van Mars" vanwege zijn rode kleur. 700x groter dan de zon!'},
  'Spica':      {dist:'250 lj', constellation:'Maagd', spectral:'B1V', fact:'Eigenlijk twee sterren die zo dicht om elkaar draaien dat ze eivormig worden uitgerekt.'},
  'Pollux':     {dist:'34 lj', constellation:'Tweelingen', spectral:'K0III', fact:'De helderste ster van Tweelingen. Heeft een bevestigde exoplaneet: "Thestias".'},
  'Fomalhaut':  {dist:'25 lj', constellation:'Zuidelijke Vis', spectral:'A3V', fact:'Omringd door een spectaculaire stofring. E\u0301\u0301\u0301n van de eerste sterren waaromheen een exoplaneet direct werd gefotografeerd.'},
  'Deneb':      {dist:'2.600 lj', constellation:'Zwaan', spectral:'A2Ia', fact:'E\u0301\u0301\u0301n van de verst verwijderde sterren die je met het blote oog kunt zien. 200.000x helderder dan de zon!'},
  'Regulus':    {dist:'79 lj', constellation:'Leeuw', spectral:'B8IV', fact:'Het "hart van de Leeuw". Draait zo snel dat hij bijna uit elkaar vliegt.'},
  'Castor':     {dist:'51 lj', constellation:'Tweelingen', spectral:'A1V', fact:'Ziet eruit als \u00e9\u00e9n ster maar is er eigenlijk ZES \u2014 drie paren sterren die om elkaar draaien.'},
  'Polaris':    {dist:'430 lj', constellation:'Kleine Beer', spectral:'F7Ib', fact:'De huidige Poolster! Staat bijna precies boven de Noordpool. Eigenlijk een drievoudig sterrensysteem.'},
  'Bellatrix':  {dist:'250 lj', constellation:'Orion', spectral:'B2III', fact:'De "Amazone-ster" \u2014 de linkerschouder van Orion. Een blauwe reus die binnenkort een rode reus wordt.'},
  'Hamal':      {dist:'66 lj', constellation:'Ram', spectral:'K2III', fact:'De helderste ster van het sterrenbeeld Ram. 2000 jaar geleden markeerde deze ster het lentepunt.'},
  'Denebola':   {dist:'36 lj', constellation:'Leeuw', spectral:'A3V', fact:'De "staart van de Leeuw". Een jonge ster met een stofschijf waaruit planeten kunnen ontstaan.'},
};

// Deep space objects: black holes, nebulae, etc.
// [name, RA hours, Dec degrees, type]
var DEEP_SKY = [
  ['Sagittarius A*', 17.761, -29.008, 'blackhole'],
  ['Cygnus X-1',     19.973, 35.202,  'blackhole'],
  ['V404 Cygni',     20.410, 33.867,  'blackhole'],
  ['A0620-00',       6.383,  -0.346,  'blackhole'],
  ['M87*',           12.514, 12.391,  'blackhole'],
  ['Orionnevel',     5.588,  -5.391,  'nebula'],
  ['Krabnevel',      5.575,  22.015,  'nebula'],
  ['Ringnevel',      18.893, 33.029,  'nebula'],
  ['Andromeda',      0.712,  41.269,  'galaxy'],
  ['Plejaden',       3.791,  24.105,  'cluster'],
];

var DEEP_SKY_FACTS = {
  'Sagittarius A*': {
    type:'Supermassief zwart gat', dist:'26.000 lj', mass:'4 miljoen zonsmassa\u2019s',
    size:'44 miljoen km (event horizon)',
    facts:[
      'Dit is het supermassieve zwarte gat in het centrum van onze Melkweg!',
      'In 2022 maakte de Event Horizon Telescope de eerste foto van Sgr A*.',
      'Sterren in de buurt draaien met 7.000 km/s om dit zwarte gat.',
      'Het zwarte gat is relatief rustig \u2014 het \u201ceet\u201d momenteel weinig materie.'
    ]
  },
  'Cygnus X-1': {
    type:'Stellair zwart gat', dist:'6.070 lj', mass:'21 zonsmassa\u2019s',
    size:'~90 km (event horizon)',
    facts:[
      'Het eerste zwarte gat dat ooit bevestigd werd (1964). Stephen Hawking wedde er nog tegen!',
      'Het zuigt materie van zijn begeleidende ster HDE 226868 en vormt een gloeiende accretieschijf.',
      'De r\u00f6ntgenstraling varieert milliseconde per milliseconde \u2014 materie valt met bijna lichtsnelheid.',
      'Hawking gaf in 1990 toe dat hij de weddenschap had verloren.'
    ]
  },
  'V404 Cygni': {
    type:'Stellair zwart gat', dist:'7.800 lj', mass:'9 zonsmassa\u2019s',
    size:'~54 km (event horizon)',
    facts:[
      'In 2015 had dit zwarte gat een enorme uitbarsting die overal ter wereld werd gedetecteerd.',
      'Het zwarte gat \u201cwankelt\u201d: de accretieschijf staat scheef en draait rond als een tol.',
      'Het is een van de actiefste zwarte gaten in onze Melkweg.',
      'De uitbarstingen duren soms maar minuten en produceren meer energie dan de zon in jaren.'
    ]
  },
  'A0620-00': {
    type:'Stellair zwart gat', dist:'3.300 lj', mass:'6,6 zonsmassa\u2019s',
    size:'~40 km (event horizon)',
    facts:[
      'Het dichtstbijzijnde bekende zwarte gat bij de aarde (update: Gaia BH1 is dichter, 1.560 lj).',
      'Het begeleidende sterretje is een K-type dwerg die 7,75 uur nodig heeft voor \u00e9\u00e9n omloop.',
      'In 1917 was er een enorme nova-uitbarsting die het 600.000x helderder maakte.',
      'Het is zo klein dat het event horizon in Nederland zou passen!'
    ]
  },
  'M87*': {
    type:'Supermassief zwart gat', dist:'55 miljoen lj', mass:'6,5 miljard zonsmassa\u2019s',
    size:'38 miljard km (event horizon)',
    facts:[
      'Dit was het EERSTE zwarte gat dat ooit gefotografeerd werd (2019, Event Horizon Telescope)!',
      'De beroemde foto toonde een donkere schaduw omringd door gloeiend gas.',
      'Het schiet een jet van plasma uit die 5.000 lichtjaar lang is!',
      'Het event horizon is groter dan ons hele zonnestelsel.'
    ]
  },
  'Orionnevel': {
    type:'Emissienevel / Stervormingsgebied', dist:'1.344 lj', size:'24 lichtjaar breed',
    facts:[
      'De dichtstbijzijnde grote stervormingsgebied \u2014 hier worden nu sterren geboren!',
      'Met het blote oog zichtbaar als een vaag vlekje in het zwaard van Orion.',
      'Bevat honderden pasgeboren sterren, sommige nog maar 100.000 jaar oud.',
      'De Trapezium-cluster in het hart verlicht de hele nevel.'
    ]
  },
  'Krabnevel': {
    type:'Supernovarestant', dist:'6.500 lj', size:'11 lichtjaar breed',
    facts:[
      'Het overblijfsel van een supernova die in 1054 werd waargenomen door Chinese astronomen.',
      'De explosie was zo helder dat hij overdag zichtbaar was \u2014 3 weken lang!',
      'In het hart draait een pulsar (neutronenster) 30x per seconde rond.',
      'De nevel breidt zich nog steeds uit met 1.500 km/s.'
    ]
  },
  'Ringnevel': {
    type:'Planetaire nevel', dist:'2.283 lj', size:'1 lichtjaar breed',
    facts:[
      'Een stervende ster die zijn buitenlagen heeft afgestoten als een kleurrijke ring.',
      'In het centrum staat een witte dwerg \u2014 de uitgebrande kern van de oorspronkelijke ster.',
      'Door een telescoop lijkt het op een rookring, vandaar de naam.',
      'Over miljarden jaren zal onze zon iets soortgelijks doen!'
    ]
  },
  'Andromeda': {
    type:'Spiraalstelsel', dist:'2,5 miljoen lj', size:'220.000 lichtjaar breed',
    facts:[
      'Het dichtstbijzijnde grote sterrenstelsel en het verst verwijderde object zichtbaar met het blote oog.',
      'Bevat naar schatting 1 biljoen sterren \u2014 meer dan onze Melkweg!',
      'Over ~4,5 miljard jaar botst Andromeda met onze Melkweg en vormen ze \u00e9\u00e9n nieuw stelsel.',
      'Het licht dat je nu ziet vertrok toen de eerste mensachtigen op aarde verschenen.'
    ]
  },
  'Plejaden': {
    type:'Open sterrenhoop', dist:'444 lj', size:'17,5 lichtjaar breed',
    facts:[
      'De \u201cZeven Zusters\u201d \u2014 een groep jonge, hete blauwe sterren die maar 100 miljoen jaar oud zijn.',
      'In bijna elke oude cultuur hebben de Plejaden een speciale betekenis.',
      'Het Japanse automerk Subaru is vernoemd naar de Plejaden (\u201csubaru\u201d = Japans voor Plejaden).',
      'Met goed zicht kun je 6-7 sterren zien, met een verrekijker meer dan 100.'
    ]
  }
};

// Animation state
var _twinklePhases = []; // random phase per star for twinkling
var _shootingStars = []; // active shooting stars
var _animFrame = null;
var _lastAnimTime = 0;

// Rendered positions for tooltip hit-detection
var _renderedStars = [];
var _renderedPlanets = [];
var _renderedDeepSky = [];

// Zodiac constellation line patterns: [[star_index_pairs]]
// Using indices into BRIGHT_STARS - simplified patterns
var ZODIAC_CONSTELLATIONS = {
  'Aries':     [[26,27]],
  'Taurus':    [[9,28]],
  'Gemini':    [[6,16,29,30]],
  'Leo':       [[15,32,33]],
  'Scorpius':  [[10,34,35]],
  'Sagittarius':[[36,37]],
  'Aquarius':  [[40,41]],
};

var PLANETS = [
  {body:'Mercury', name:'Mercurius', color:'#94a3b8', size:3},
  {body:'Venus',   name:'Venus',     color:'#fbbf24', size:4},
  {body:'Mars',    name:'Mars',      color:'#ef4444', size:4},
  {body:'Jupiter', name:'Jupiter',   color:'#f97316', size:5},
  {body:'Saturn',  name:'Saturnus',  color:'#a3e635', size:5},
  {body:'Uranus',  name:'Uranus',    color:'#06b6d4', size:3},
  {body:'Neptune', name:'Neptunus',  color:'#3b82f6', size:3},
];

// Planet facts for tooltips
var PLANET_FACTS = {
  'Zon': {
    type: 'Ster (G2V gele dwerg)', diameter: '1.392.700 km', dist: '149,6 miljoen km',
    temp: '5.500\u00b0C (oppervlak)', manen: '\u2014',
    facts: [
      'De zon bevat 99,86% van alle massa in ons zonnestelsel.',
      'Elke seconde zet de zon 600 miljoen ton waterstof om in helium.',
      'Licht van de zon doet er 8 minuten en 20 seconden over om de aarde te bereiken.',
      'De zon is al 4,6 miljard jaar oud en is pas op de helft van zijn leven.'
    ]
  },
  'Maan': {
    type: 'Natuurlijke satelliet', diameter: '3.474 km', dist: '384.400 km',
    temp: '-173\u00b0C tot +127\u00b0C', manen: '\u2014',
    facts: [
      'De maan beweegt elk jaar 3,8 cm van de aarde af.',
      'Er is nooit wind op de maan \u2014 voetstappen van astronauten staan er nog steeds.',
      'De maan heeft zwakke maanbevingen, ontdekt door Apollo-seismometers.',
      'Je kunt op de maan 6x zo hoog springen als op aarde door de lagere zwaartekracht.'
    ]
  },
  'Mercurius': {
    type: 'Rotsplaneet', diameter: '4.879 km', dist: '57,9 miljoen km',
    temp: '-180\u00b0C tot +430\u00b0C', manen: '0',
    facts: [
      'Een dag op Mercurius (176 aardse dagen) duurt langer dan een jaar (88 dagen)!',
      'Mercurius heeft het grootste temperatuurverschil van alle planeten: 610\u00b0C.',
      'Ondanks dat hij het dichtst bij de zon staat, is hij niet de heetste planeet \u2014 dat is Venus.',
      'Mercurius is gekrompen: de planeet is 7 km kleiner geworden door afkoeling.'
    ]
  },
  'Venus': {
    type: 'Rotsplaneet', diameter: '12.104 km', dist: '108,2 miljoen km',
    temp: '+465\u00b0C (gemiddeld)', manen: '0',
    facts: [
      'Venus draait "achteruit" \u2014 de zon komt er in het westen op en gaat in het oosten onder.',
      'De atmosfeerdruk op Venus is 92x die van de aarde, vergelijkbaar met 900 meter diep in de oceaan.',
      'Een dag op Venus (243 aardse dagen) duurt langer dan een Venus-jaar (225 dagen).',
      'Het regent zwavelzuur op Venus, maar het verdampt voordat het de grond raakt.'
    ]
  },
  'Mars': {
    type: 'Rotsplaneet', diameter: '6.779 km', dist: '227,9 miljoen km',
    temp: '-60\u00b0C (gemiddeld)', manen: '2 (Phobos, Deimos)',
    facts: [
      'De Olympus Mons op Mars is de hoogste vulkaan in het zonnestelsel: 21,9 km hoog!',
      'Mars heeft seizoenen net als de aarde, maar ze duren bijna twee keer zo lang.',
      'De rode kleur komt van ijzeroxide (roest) in de bodem.',
      'Mars heeft een canyon (Valles Marineris) zo groot dat hij van Amsterdam tot Teheran zou reiken.'
    ]
  },
  'Jupiter': {
    type: 'Gasreus', diameter: '139.820 km', dist: '778,5 miljoen km',
    temp: '-110\u00b0C (wolkentoppen)', manen: '95 (bekend)',
    facts: [
      'De Grote Rode Vlek is een storm die al minstens 350 jaar woedt \u2014 groter dan de aarde!',
      'Jupiter beschermt de aarde: zijn zwaartekracht vangt veel kometen en asteroïden op.',
      'Jupiter heeft de kortste dag van alle planeten: slechts 9 uur en 55 minuten.',
      'In Jupiters atmosfeer regent het mogelijk diamanten.'
    ]
  },
  'Saturnus': {
    type: 'Gasreus', diameter: '116.460 km', dist: '1,434 miljard km',
    temp: '-140\u00b0C (wolkentoppen)', manen: '146 (bekend)',
    facts: [
      'Saturnus is zo licht dat hij zou drijven als je een bad groot genoeg had.',
      'De ringen bestaan uit miljarden ijsdeeltjes, van stofkorrels tot huizen zo groot.',
      'Zijn maan Titan heeft meren van vloeibaar methaan en een dichtere atmosfeer dan de aarde.',
      'De ringen zijn verrassend dun: slechts 10 meter dik, maar 282.000 km breed.'
    ]
  },
  'Uranus': {
    type: 'IJsreus', diameter: '50.724 km', dist: '2,871 miljard km',
    temp: '-224\u00b0C', manen: '28 (bekend)',
    facts: [
      'Uranus draait op zijn zij \u2014 zijn rotatie-as staat bijna 98\u00b0 scheef!',
      'Dit betekent dat elke pool 42 jaar lang continu zonlicht krijgt, en dan 42 jaar duisternis.',
      'Uranus werd pas in 1781 ontdekt door William Herschel, de eerste "moderne" planeetontdekking.',
      'De blauwe kleur komt van methaan in de atmosfeer dat rood licht absorbeert.'
    ]
  },
  'Neptunus': {
    type: 'IJsreus', diameter: '49.528 km', dist: '4,495 miljard km',
    temp: '-218\u00b0C', manen: '16 (bekend)',
    facts: [
      'Neptunus heeft de sterkste winden in het zonnestelsel: tot 2.100 km/u!',
      'E\u00e9n jaar op Neptunus duurt 165 aardse jaren. Sinds zijn ontdekking in 1846 heeft hij pas \u00e9\u00e9n omloop voltooid (2011).',
      'Zijn maan Triton is het koudste bekende object in het zonnestelsel (-235\u00b0C).',
      'Neptunus werd wiskundig voorspeld voordat hij werd waargenomen \u2014 de enige planeet ontdekt door berekening!'
    ]
  }
};

// ============================================================
// TAB NAVIGATION
// ============================================================
function showPanel(id){
  document.querySelectorAll('.panel').forEach(function(p){ p.classList.remove('active'); });
  document.querySelectorAll('.tab').forEach(function(t){ t.classList.remove('active'); });
  document.getElementById('panel'+id.charAt(0).toUpperCase()+id.slice(1)).classList.add('active');
  event.target.closest('.tab').classList.add('active');
  if(id==='sky') updateSky();
  if(id==='planeten'){ planetNow(); }
  if(id==='precessie') updatePrecess();
}

// ============================================================
// STAR CHART
// ============================================================
var _skyDragStart = null;
var _skyRotX = 0, _skyRotY = 0;

function skyNow(){
  var now = new Date();
  var offset = now.getTimezoneOffset();
  var local = new Date(now.getTime() - offset * 60000);
  document.getElementById('skyDate').value = local.toISOString().slice(0,16);
  updateSky();
}

function getObserver(){
  var loc = document.getElementById('skyLocation').value.split(',');
  return new Astronomy.Observer(parseFloat(loc[0]), parseFloat(loc[1]), 0);
}

function getSkyDate(){
  var val = document.getElementById('skyDate').value;
  return val ? new Date(val) : new Date();
}

function raDecToAltAz(ra, dec, date, observer){
  return Astronomy.Horizon(date, observer, ra, dec, 'normal');
}

function altAzToCanvas(alt, az, cx, cy, radius, zoom){
  // Stereographic projection from zenith
  var r = radius * (90 - alt) / 90 * zoom;
  var azRad = az * Math.PI / 180;
  var x = cx + r * Math.sin(azRad);
  var y = cy - r * Math.cos(azRad);
  return {x:x, y:y, visible: alt > -5};
}

function updateSky(){
  var canvas = document.getElementById('skyCanvas');
  var ctx = canvas.getContext('2d');
  var W = canvas.width, H = canvas.height;
  var cx = W/2, cy = H/2;
  var radius = Math.min(W,H)/2 - 20;
  var zoom = parseFloat(document.getElementById('skyZoom').value) || 1;
  var date = getSkyDate();
  var observer = getObserver();

  // Clear
  ctx.fillStyle = '#050810';
  ctx.fillRect(0,0,W,H);

  // Draw horizon circle
  ctx.beginPath();
  ctx.arc(cx, cy, radius, 0, Math.PI*2);
  ctx.strokeStyle = 'rgba(148,163,184,.15)';
  ctx.lineWidth = 1;
  ctx.stroke();

  // Cardinal directions
  ctx.font = '11px "DM Sans"';
  ctx.fillStyle = 'rgba(148,163,184,.4)';
  ctx.textAlign = 'center';
  ctx.fillText('N', cx, cy - radius - 6);
  ctx.fillText('Z', cx, cy + radius + 14);
  ctx.fillText('O', cx + radius + 12, cy + 4);
  ctx.fillText('W', cx - radius - 12, cy + 4);

  // Altitude circles
  for(var a = 30; a <= 60; a += 30){
    var r = radius * (90 - a) / 90 * zoom;
    if(r > 0 && r < radius){
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(148,163,184,.06)';
      ctx.stroke();
      ctx.fillStyle = 'rgba(148,163,184,.2)';
      ctx.font = '9px "Space Mono"';
      ctx.fillText(a+'\u00b0', cx+r+8, cy);
    }
  }

  // Draw ecliptic
  ctx.beginPath();
  var eclFirst = true;
  for(var ecl = 0; ecl < 360; ecl += 2){
    var eclRa = ecl / 15; // rough
    var eclDec = 23.44 * Math.sin(ecl * Math.PI / 180);
    var hor = raDecToAltAz(eclRa, eclDec, date, observer);
    var p = altAzToCanvas(hor.altitude, hor.azimuth, cx, cy, radius, zoom);
    if(p.visible){
      if(eclFirst){ ctx.moveTo(p.x, p.y); eclFirst=false; }
      else ctx.lineTo(p.x, p.y);
    }
  }
  ctx.strokeStyle = 'rgba(251,191,36,.15)';
  ctx.lineWidth = 1;
  ctx.stroke();

  // Draw stars
  _renderedStars = [];
  BRIGHT_STARS.forEach(function(star){
    var hor = raDecToAltAz(star[1], star[2], date, observer);
    var p = altAzToCanvas(hor.altitude, hor.azimuth, cx, cy, radius, zoom);
    if(!p.visible) return;
    if(p.x < 0 || p.x > W || p.y < 0 || p.y > H) return;

    var mag = star[3];
    var size = Math.max(0.5, 3.5 - mag * 0.8);
    var alpha = Math.max(0.2, Math.min(1, 1.2 - mag * 0.25));

    // Star color based on spectral type (from STAR_FACTS)
    var starColor = '255,255,240';
    var sf = STAR_FACTS[star[0]];
    if(sf && sf.spectral){
      var sp = sf.spectral.charAt(0);
      if(sp==='O'||sp==='B') starColor = '170,200,255'; // blue
      else if(sp==='A') starColor = '220,230,255'; // blue-white
      else if(sp==='F') starColor = '255,255,240'; // white
      else if(sp==='G') starColor = '255,245,200'; // yellow
      else if(sp==='K') starColor = '255,210,160'; // orange
      else if(sp==='M') starColor = '255,180,140'; // red
    }

    // Glow
    if(mag < 1.5){
      var grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, size*3);
      grad.addColorStop(0, 'rgba('+starColor+','+alpha*0.3+')');
      grad.addColorStop(1, 'rgba('+starColor+',0)');
      ctx.fillStyle = grad;
      ctx.fillRect(p.x-size*3, p.y-size*3, size*6, size*6);
    }

    ctx.beginPath();
    ctx.arc(p.x, p.y, size, 0, Math.PI*2);
    ctx.fillStyle = 'rgba('+starColor+','+alpha+')';
    ctx.fill();

    // Store for tooltip hit-detection
    _renderedStars.push({x:p.x, y:p.y, name:star[0], mag:mag, alt:hor.altitude, az:hor.azimuth});

    // Label bright stars
    if(mag < 1.5){
      ctx.font = '8px "DM Sans"';
      ctx.fillStyle = 'rgba(148,163,184,.5)';
      ctx.textAlign = 'left';
      ctx.fillText(star[0], p.x + size + 3, p.y + 3);
    }
  });

  // Draw planets
  var bodyNames = ['Sun','Moon','Mercury','Venus','Mars','Jupiter','Saturn','Uranus','Neptune'];
  var bodyColors = {'Sun':'#fbbf24','Moon':'#e2e8f0','Mercury':'#94a3b8','Venus':'#fbbf24','Mars':'#ef4444','Jupiter':'#f97316','Saturn':'#a3e635','Uranus':'#06b6d4','Neptune':'#3b82f6'};
  var bodyNamesNL = {'Sun':'Zon','Moon':'Maan','Mercury':'Mercurius','Venus':'Venus','Mars':'Mars','Jupiter':'Jupiter','Saturn':'Saturnus','Uranus':'Uranus','Neptune':'Neptunus'};
  var bodySizes = {'Sun':6,'Moon':5,'Mercury':2.5,'Venus':3.5,'Mars':3,'Jupiter':4,'Saturn':3.5,'Uranus':2.5,'Neptune':2.5};

  _renderedPlanets = [];
  bodyNames.forEach(function(bname){
    try {
      var eq = Astronomy.Equator(bname, date, observer, true, true);
      var hor = Astronomy.Horizon(date, observer, eq.ra, eq.dec, 'normal');
      var p = altAzToCanvas(hor.altitude, hor.azimuth, cx, cy, radius, zoom);
      if(!p.visible) return;
      if(p.x < 0 || p.x > W || p.y < 0 || p.y > H) return;

      var col = bodyColors[bname] || '#fff';
      var sz = bodySizes[bname] || 3;

      // Glow
      var grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, sz*4);
      grad.addColorStop(0, col.replace(')', ',.3)').replace('rgb','rgba'));
      grad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = grad;
      ctx.fillRect(p.x-sz*4, p.y-sz*4, sz*8, sz*8);

      ctx.beginPath();
      ctx.arc(p.x, p.y, sz, 0, Math.PI*2);
      ctx.fillStyle = col;
      ctx.fill();

      // Store for tooltip hit-detection
      _renderedPlanets.push({x:p.x, y:p.y, name:bodyNamesNL[bname], color:col, alt:hor.altitude, az:hor.azimuth});

      ctx.font = '9px "DM Sans"';
      ctx.fillStyle = col;
      ctx.textAlign = 'left';
      ctx.fillText(bodyNamesNL[bname], p.x + sz + 4, p.y + 3);
    } catch(e){}
  });

  // Draw deep sky objects (black holes, nebulae, galaxies)
  _renderedDeepSky = [];
  DEEP_SKY.forEach(function(ds){
    var hor = raDecToAltAz(ds[1], ds[2], date, observer);
    var p = altAzToCanvas(hor.altitude, hor.azimuth, cx, cy, radius, zoom);
    if(!p.visible) return;
    if(p.x < 0 || p.x > W || p.y < 0 || p.y > H) return;

    var dsType = ds[3];
    if(dsType === 'blackhole'){
      // Black hole: dark core with accretion disk glow
      var bhGlow = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 14);
      bhGlow.addColorStop(0, 'rgba(0,0,0,0)');
      bhGlow.addColorStop(0.3, 'rgba(0,0,0,0.8)');
      bhGlow.addColorStop(0.5, 'rgba(168,85,247,0.4)');
      bhGlow.addColorStop(0.7, 'rgba(251,191,36,0.2)');
      bhGlow.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = bhGlow;
      ctx.fillRect(p.x-14, p.y-14, 28, 28);
      // Dark center
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
      ctx.fillStyle = '#000';
      ctx.fill();
      ctx.strokeStyle = 'rgba(168,85,247,0.6)';
      ctx.lineWidth = 1;
      ctx.stroke();
      // Accretion ring
      ctx.beginPath();
      ctx.ellipse(p.x, p.y, 7, 3, 0.3, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(251,191,36,0.35)';
      ctx.lineWidth = 1.5;
      ctx.stroke();
      // Label
      ctx.font = '7px "DM Sans"';
      ctx.fillStyle = 'rgba(168,85,247,0.6)';
      ctx.textAlign = 'left';
      ctx.fillText(ds[0], p.x + 10, p.y + 3);
    } else if(dsType === 'nebula'){
      // Nebula: fuzzy colorful cloud
      var nebGrad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 10);
      nebGrad.addColorStop(0, 'rgba(236,72,153,0.25)');
      nebGrad.addColorStop(0.5, 'rgba(168,85,247,0.12)');
      nebGrad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = nebGrad;
      ctx.fillRect(p.x-10, p.y-10, 20, 20);
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(236,72,153,0.4)';
      ctx.fill();
      ctx.font = '7px "DM Sans"';
      ctx.fillStyle = 'rgba(236,72,153,0.5)';
      ctx.textAlign = 'left';
      ctx.fillText(ds[0], p.x + 6, p.y + 3);
    } else if(dsType === 'galaxy'){
      // Galaxy: tiny spiral
      var galGrad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 12);
      galGrad.addColorStop(0, 'rgba(226,232,240,0.3)');
      galGrad.addColorStop(0.4, 'rgba(59,130,246,0.15)');
      galGrad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = galGrad;
      ctx.fillRect(p.x-12, p.y-12, 24, 24);
      ctx.beginPath();
      ctx.ellipse(p.x, p.y, 6, 2.5, 0.5, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(226,232,240,0.2)';
      ctx.fill();
      ctx.strokeStyle = 'rgba(226,232,240,0.15)';
      ctx.lineWidth = 0.5;
      ctx.stroke();
      ctx.font = '7px "DM Sans"';
      ctx.fillStyle = 'rgba(59,130,246,0.5)';
      ctx.textAlign = 'left';
      ctx.fillText(ds[0], p.x + 8, p.y + 3);
    } else if(dsType === 'cluster'){
      // Star cluster: group of tiny dots
      for(var ci=0;ci<7;ci++){
        var ca = Math.random()*Math.PI*2, cr = Math.random()*5;
        ctx.beginPath();
        ctx.arc(p.x + cr*Math.cos(ca), p.y + cr*Math.sin(ca), 0.8, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(170,200,255,0.5)';
        ctx.fill();
      }
      ctx.font = '7px "DM Sans"';
      ctx.fillStyle = 'rgba(170,200,255,0.5)';
      ctx.textAlign = 'left';
      ctx.fillText(ds[0], p.x + 8, p.y + 3);
    }

    _renderedDeepSky.push({x:p.x, y:p.y, name:ds[0], type:dsType, alt:hor.altitude, az:hor.azimuth});
  });

  // Update info bar
  try {
    var sunEq = Astronomy.Equator('Sun', date, observer, true, true);
    var sunHor = Astronomy.Horizon(date, observer, sunEq.ra, sunEq.dec, 'normal');
    var moonEq = Astronomy.Equator('Moon', date, observer, true, true);
    var moonHor = Astronomy.Horizon(date, observer, moonEq.ra, moonEq.dec, 'normal');
    var phase = Astronomy.MoonPhase(date);

    document.getElementById('skyInfoTime').textContent = date.toLocaleString('nl-NL');
    var loc = document.getElementById('skyLocation').value.split(',');
    document.getElementById('skyInfoLoc').textContent = 'Lat '+loc[0]+' Lon '+loc[1];
    document.getElementById('skyInfoSun').textContent = 'Zon: '+sunHor.altitude.toFixed(1)+'\u00b0 alt';
    document.getElementById('skyInfoMoon').textContent = 'Maan: '+moonHor.altitude.toFixed(1)+'\u00b0 alt \u00b7 fase '+phase.toFixed(0)+'\u00b0';
  } catch(e){}
}

// Canvas drag
(function(){
  var canvas = document.getElementById('skyCanvas');
  canvas.addEventListener('mousedown', function(e){ _skyDragStart = {x:e.clientX, y:e.clientY}; });
  canvas.addEventListener('mousemove', function(e){
    if(!_skyDragStart) return;
    _skyRotX += (e.clientX - _skyDragStart.x) * 0.5;
    _skyRotY += (e.clientY - _skyDragStart.y) * 0.5;
    _skyDragStart = {x:e.clientX, y:e.clientY};
    updateSky();
  });
  canvas.addEventListener('mouseup', function(){ _skyDragStart = null; });
  canvas.addEventListener('mouseleave', function(){ _skyDragStart = null; });
  canvas.addEventListener('wheel', function(e){
    e.preventDefault();
    var z = document.getElementById('skyZoom');
    z.value = Math.max(0.5, Math.min(3, parseFloat(z.value) - e.deltaY * 0.002));
    updateSky();
  });
})();

// ============================================================
// STAR ANIMATION (twinkle + shooting stars)
// ============================================================
function startSkyAnimation(){
  if(_animFrame) return;
  // Initialize twinkle phases
  _twinklePhases = [];
  for(var i = 0; i < 100; i++){
    _twinklePhases.push(Math.random() * Math.PI * 2);
  }
  _lastAnimTime = performance.now();
  animateSky();
}

function animateSky(){
  _animFrame = requestAnimationFrame(animateSky);
  var now = performance.now();
  var dt = (now - _lastAnimTime) / 1000;
  _lastAnimTime = now;

  var canvas = document.getElementById('skyCanvas');
  var ctx = canvas.getContext('2d');
  var W = canvas.width, H = canvas.height;

  // Only animate if the sky panel is active
  if(!document.getElementById('panelSky').classList.contains('active')){
    return;
  }

  // Overlay: draw twinkle effects on top of existing render
  // We re-render the sky periodically to get twinkling
  var time = now / 1000;

  // Draw twinkle layer over rendered stars
  _renderedStars.forEach(function(star, idx){
    var phase = _twinklePhases[idx % _twinklePhases.length];
    var twinkle = 0.7 + 0.3 * Math.sin(time * (1.5 + (idx % 5) * 0.4) + phase);
    // Only draw if star is bright enough to notice
    if(star.mag > 2.5) return;

    var sf = STAR_FACTS[star.name];
    var starColor = '255,255,240';
    if(sf && sf.spectral){
      var sp = sf.spectral.charAt(0);
      if(sp==='O'||sp==='B') starColor = '170,200,255';
      else if(sp==='A') starColor = '220,230,255';
      else if(sp==='G') starColor = '255,245,200';
      else if(sp==='K') starColor = '255,210,160';
      else if(sp==='M') starColor = '255,180,140';
    }

    // Subtle twinkle glow
    var glowSize = (3.5 - star.mag * 0.5) * twinkle;
    if(glowSize > 0.5){
      var grad = ctx.createRadialGradient(star.x, star.y, 0, star.x, star.y, glowSize * 2.5);
      grad.addColorStop(0, 'rgba('+starColor+','+(twinkle*0.15)+')');
      grad.addColorStop(1, 'rgba('+starColor+',0)');
      ctx.fillStyle = grad;
      ctx.fillRect(star.x - glowSize*2.5, star.y - glowSize*2.5, glowSize*5, glowSize*5);
    }
  });

  // Shooting stars
  // Spawn new one randomly (~every 6 seconds)
  if(Math.random() < dt / 6){
    var startX = Math.random() * W * 0.8 + W * 0.1;
    var startY = Math.random() * H * 0.4;
    var angle = (0.5 + Math.random() * 0.5) * Math.PI; // downward-ish
    var speed = 300 + Math.random() * 400;
    _shootingStars.push({
      x: startX, y: startY,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life: 0, maxLife: 0.4 + Math.random() * 0.4,
      trail: []
    });
  }

  // Update and draw shooting stars
  for(var si = _shootingStars.length - 1; si >= 0; si--){
    var ss = _shootingStars[si];
    ss.life += dt;
    ss.x += ss.vx * dt;
    ss.y += ss.vy * dt;
    ss.trail.push({x:ss.x, y:ss.y});
    if(ss.trail.length > 15) ss.trail.shift();

    var fade = 1 - (ss.life / ss.maxLife);
    if(fade <= 0 || ss.x < 0 || ss.x > W || ss.y > H){
      _shootingStars.splice(si, 1);
      continue;
    }

    // Draw trail
    if(ss.trail.length > 1){
      ctx.beginPath();
      ctx.moveTo(ss.trail[0].x, ss.trail[0].y);
      for(var ti = 1; ti < ss.trail.length; ti++){
        ctx.lineTo(ss.trail[ti].x, ss.trail[ti].y);
      }
      var trailGrad = ctx.createLinearGradient(
        ss.trail[0].x, ss.trail[0].y,
        ss.trail[ss.trail.length-1].x, ss.trail[ss.trail.length-1].y
      );
      trailGrad.addColorStop(0, 'rgba(255,255,240,0)');
      trailGrad.addColorStop(1, 'rgba(255,255,240,'+(fade*0.7)+')');
      ctx.strokeStyle = trailGrad;
      ctx.lineWidth = 1.5 * fade;
      ctx.stroke();
    }

    // Bright head
    ctx.beginPath();
    ctx.arc(ss.x, ss.y, 1.5 * fade, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,255,255,'+(fade*0.9)+')';
    ctx.fill();
  }
}

function stopSkyAnimation(){
  if(_animFrame){
    cancelAnimationFrame(_animFrame);
    _animFrame = null;
  }
}

// ============================================================
// HOROSCOPE
// ============================================================
function getSunEclipticLong(date){
  try {
    var eq = Astronomy.Equator('Sun', date, new Astronomy.Observer(0,0,0), true, true);
    var ecl = Astronomy.Ecliptic(eq.vec);
    return ecl.elon;
  } catch(e){ return 0; }
}

function getTropicalSign(elon){
  var idx = Math.floor(elon / 30) % 12;
  return ZODIAC[idx];
}

function getSiderealSign(elon, year){
  var ayan = getAyanamsa(year);
  var siderealLon = (elon - ayan + 360) % 360;
  var idx = Math.floor(siderealLon / 30) % 12;
  return ZODIAC[idx];
}

function calcHoroscope(){
  var dateStr = document.getElementById('birthDate').value;
  var timeStr = document.getElementById('birthTime').value || '12:00';
  var locStr = document.getElementById('birthPlace').value;
  var loc = locStr.split(',');
  var lat = parseFloat(loc[0]), lon = parseFloat(loc[1]);

  var date = new Date(dateStr + 'T' + timeStr + ':00');
  if(isNaN(date.getTime())){ alert('Ongeldige datum'); return; }

  var observer = new Astronomy.Observer(lat, lon, 0);
  var year = date.getFullYear();

  // Sun position
  var sunLon = getSunEclipticLong(date);
  var tropSign = getTropicalSign(sunLon);
  var siderSign = getSiderealSign(sunLon, year);
  var ayan = getAyanamsa(year);

  // Ascendant
  var asc = calcAscendant(date, lat, lon);
  var ascSign = asc.sign;

  // Moon sign
  var moonSign = null;
  try {
    var moonEq = Astronomy.Equator('Moon', date, observer, true, true);
    var moonEcl = Astronomy.Ecliptic(moonEq.vec);
    moonSign = getTropicalSign(moonEcl.elon);
  } catch(e){}

  // Planet positions
  var planetPositions = [];
  if(moonSign){
    planetPositions.push({name:'Maan', sign:moonSign.name, lon:moonEcl.elon, color:'#e2e8f0'});
  }
  PLANETS.forEach(function(pl){
    try {
      var eq = Astronomy.Equator(pl.body, date, observer, true, true);
      var ecl = Astronomy.Ecliptic(eq.vec);
      var sign = getTropicalSign(ecl.elon);
      planetPositions.push({name:pl.name, sign:sign.name, lon:ecl.elon, color:pl.color});
    } catch(e){}
  });

  // ── PROFILE CARD ──
  var html = '<div class="profile-card">';
  html += '<div class="profile-header">';
  html += '<div class="profile-symbol">'+tropSign.symbol+'</div>';
  html += '<div class="profile-titles">';
  html += '<h3>Jouw Kosmisch Profiel</h3>';
  html += '<p>'+date.toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'})+' om '+timeStr+'</p>';
  html += '</div></div>';

  // Three pillars: Zon, Maan, Ascendant
  html += '<div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px">';
  // Zon
  html += '<div style="flex:1;min-width:140px;background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.2);border-radius:var(--rs);padding:12px;text-align:center">';
  html += '<div style="font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px">\u2609 Zonteken</div>';
  html += '<div style="font-size:32px;margin:4px 0">'+tropSign.symbol+'</div>';
  html += '<div style="font:700 14px var(--font);color:var(--gold)">'+tropSign.name+'</div>';
  html += '<div style="font:10px var(--font);color:var(--tx3)">'+tropSign.element+' \u00b7 '+tropSign.quality+'</div>';
  html += '</div>';
  // Maan
  if(moonSign){
    html += '<div style="flex:1;min-width:140px;background:rgba(226,232,240,.06);border:1px solid rgba(226,232,240,.15);border-radius:var(--rs);padding:12px;text-align:center">';
    html += '<div style="font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px">\u263d Maanteken</div>';
    html += '<div style="font-size:32px;margin:4px 0">'+moonSign.symbol+'</div>';
    html += '<div style="font:700 14px var(--font);color:var(--tx)">'+moonSign.name+'</div>';
    html += '<div style="font:10px var(--font);color:var(--tx3)">Je emotionele kern</div>';
    html += '</div>';
  }
  // Ascendant
  html += '<div style="flex:1;min-width:140px;background:rgba(168,85,247,.08);border:1px solid rgba(168,85,247,.2);border-radius:var(--rs);padding:12px;text-align:center">';
  html += '<div style="font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px">\u2191 Ascendant</div>';
  html += '<div style="font-size:32px;margin:4px 0">'+ascSign.symbol+'</div>';
  html += '<div style="font:700 14px var(--font);color:var(--purple)">'+ascSign.name+'</div>';
  html += '<div style="font:10px var(--font);color:var(--tx3)">'+asc.degInSign.toFixed(1)+'\u00b0 in '+ascSign.name+'</div>';
  html += '</div>';
  html += '</div>';

  // Ascendant description
  html += '<div style="background:rgba(168,85,247,.06);border:1px solid rgba(168,85,247,.12);border-radius:var(--rs);padding:10px;margin-bottom:12px">';
  html += '<div style="font:600 12px var(--font);color:var(--purple);margin-bottom:4px">\u2191 Je Ascendant: '+ascSign.name+'</div>';
  html += '<div style="font:11px var(--font);color:var(--tx2)">'+ascSign.ascDesc+'</div>';
  html += '</div>';

  // Strengths & Weaknesses
  html += '<div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">';
  html += '<div style="flex:1;min-width:200px">';
  html += '<div style="font:600 11px var(--font);color:var(--green);margin-bottom:6px">\u2728 Sterke punten ('+tropSign.name+')</div>';
  html += '<div class="trait-tags">';
  tropSign.strengths.forEach(function(s){ html += '<span class="trait-tag strength">'+s+'</span>'; });
  html += '</div></div>';
  html += '<div style="flex:1;min-width:200px">';
  html += '<div style="font:600 11px var(--font);color:var(--red);margin-bottom:6px">\u26a0 Valkuilen</div>';
  html += '<div class="trait-tags">';
  tropSign.weaknesses.forEach(function(w){ html += '<span class="trait-tag weakness">'+w+'</span>'; });
  html += '</div></div>';
  html += '</div>';

  // Love style
  html += '<div style="background:rgba(236,72,153,.06);border:1px solid rgba(236,72,153,.15);border-radius:var(--rs);padding:10px;margin-bottom:12px">';
  html += '<div style="font:600 11px var(--font);color:#ec4899;margin-bottom:3px">\u2764\ufe0f Liefdesstijl</div>';
  html += '<div style="font:11px var(--font);color:var(--tx2)">'+tropSign.loveStyle+'</div>';
  html += '</div>';

  // Tropisch vs Siderisch verschil
  if(tropSign.id !== siderSign.id){
    html += '<div style="background:rgba(239,68,68,.06);border:1px solid rgba(239,68,68,.15);border-radius:var(--rs);padding:10px;font-size:11px;margin-bottom:12px">';
    html += '<span class="mi" style="color:var(--red);font-size:14px;vertical-align:-3px">info</span> ';
    html += '<b style="color:var(--red)">Tropisch vs. Siderisch:</b> De astrologie zegt <b>'+tropSign.name+'</b>, maar astronomisch stond de zon in <b>'+siderSign.name+'</b> '+siderSign.symbol+'. ';
    html += 'Dit komt door precessie (~'+ayan.toFixed(1)+'\u00b0 verschuiving sinds Ptolemaeus).';
    html += '</div>';
  }

  // Planet positions
  html += '<h3 style="color:var(--blue)">\ud83c\udf0c Planeetposities bij geboorte</h3>';
  html += '<div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px">';
  planetPositions.forEach(function(pp){
    html += '<div style="background:var(--glass);border:1px solid var(--glass-bd);border-radius:var(--rs);padding:6px 10px;font-size:11px;display:flex;align-items:center;gap:5px">';
    html += '<span class="planet-dot" style="background:'+pp.color+';width:8px;height:8px"></span>';
    html += '<b>'+pp.name+'</b> in <span style="color:var(--gold)">'+pp.sign+'</span>';
    html += ' <span style="color:var(--tx3);font:9px var(--mono)">'+pp.lon.toFixed(1)+'\u00b0</span>';
    html += '</div>';
  });
  html += '</div>';

  // Compatibility
  html += buildCompatibilityHTML(tropSign, ascSign);

  html += '</div>'; // close profile-card
  document.getElementById('horoscopeResult').innerHTML = html;

  // Draw natal chart
  document.getElementById('natalChartSection').style.display = 'block';
  drawNatalChart(asc.longitude, asc.mc, planetPositions, sunLon);

  // Natal chart info panel
  var infoHtml = '<div class="card" style="margin:0">';
  infoHtml += '<h2 style="font-size:14px"><span class="mi" style="color:var(--purple)">donut_large</span> Geboortekaart</h2>';
  infoHtml += '<p style="font-size:11px;color:var(--tx2);margin-bottom:10px">De buitenring toont de 12 sterrenbeelden, de binnenring de 12 huizen (gelijk-huis-systeem vanaf je ascendant). De gele lijn is je ascendant (ASC), de paarse lijn is het Medium Coeli (MC).</p>';

  infoHtml += '<div class="result-row"><span class="result-label">\u2609 Zon</span><span class="result-val gold">'+tropSign.symbol+' '+tropSign.name+' ('+sunLon.toFixed(1)+'\u00b0)</span></div>';
  if(moonSign) infoHtml += '<div class="result-row"><span class="result-label">\u263d Maan</span><span class="result-val">'+moonSign.symbol+' '+moonSign.name+'</span></div>';
  infoHtml += '<div class="result-row"><span class="result-label">\u2191 ASC</span><span class="result-val purple">'+ascSign.symbol+' '+ascSign.name+' ('+asc.degInSign.toFixed(1)+'\u00b0)</span></div>';
  infoHtml += '<div class="result-row"><span class="result-label">MC</span><span class="result-val">'+asc.mc.toFixed(1)+'\u00b0</span></div>';

  planetPositions.forEach(function(pp){
    infoHtml += '<div class="result-row"><span class="result-label"><span class="planet-dot" style="background:'+pp.color+'"></span>'+pp.name+'</span><span class="result-val">'+pp.sign+' ('+pp.lon.toFixed(1)+'\u00b0)</span></div>';
  });

  infoHtml += '</div>';
  document.getElementById('natalInfo').innerHTML = infoHtml;
}

// Build zodiac grid
function buildZodiacGrid(){
  var html = '';
  ZODIAC.forEach(function(z){
    html += '<div class="zodiac-card" onclick="selectZodiac(\''+z.id+'\')" id="zcard_'+z.id+'">';
    html += '<div class="zodiac-symbol">'+z.symbol+'</div>';
    html += '<div class="zodiac-name">'+z.name+'</div>';
    html += '<div class="zodiac-dates">'+z.tropisch+'</div>';
    html += '</div>';
  });
  document.getElementById('zodiacGrid').innerHTML = html;
}

function selectZodiac(id){
  document.querySelectorAll('.zodiac-card').forEach(function(c){ c.classList.remove('active'); });
  var el = document.getElementById('zcard_'+id);
  if(el) el.classList.add('active');
  var z = ZODIAC.filter(function(x){ return x.id===id; })[0];
  if(!z) return;
  // Show info below the grid
  var parent = document.getElementById('zodiacGrid').parentElement;
  var existing = document.getElementById('zodiacDetail');
  if(existing) existing.remove();
  var div = document.createElement('div');
  div.id = 'zodiacDetail';
  div.className = 'result-box';
  div.style.marginTop = '12px';
  div.innerHTML = '<div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">'+
    '<span style="font-size:32px">'+z.symbol+'</span>'+
    '<div><div style="font:700 14px var(--font)">'+z.name+' <span style="color:var(--tx3);font-weight:400;font-size:11px">('+z.nameEn+')</span></div>'+
    '<div style="font:10px var(--mono);color:var(--tx3)">'+z.element+' \u00b7 Heerser: '+z.ruler+'</div></div></div>'+
    '<div style="font-size:12px;color:var(--tx2);margin-bottom:8px">'+z.desc+'</div>'+
    '<div class="result-row"><span class="result-label">Tropisch (astrologie)</span><span class="result-val gold">'+z.tropisch+'</span></div>'+
    '<div class="result-row"><span class="result-label">Siderisch (astronomie)</span><span class="result-val purple">'+z.siderisch+'</span></div>';
  parent.appendChild(div);
}

// ============================================================
// PRECESSIE
// ============================================================
function updatePrecess(){
  var year = parseInt(document.getElementById('precessSlider').value);
  document.getElementById('precessYear').textContent = year;

  // Calculate shift: ~1 degree per 72 years from ~150 AD reference point
  var shift = (year - 150) / 72;  // degrees of precession since Ptolemy
  var shiftMod = ((shift % 360) + 360) % 360;

  document.getElementById('precessShift').textContent = shiftMod.toFixed(1) + '\u00b0';

  // Which constellation is the vernal equinox in?
  var vpIdx = Math.floor(((360 - shiftMod) % 360) / 30) % 12;
  document.getElementById('precessSign').textContent = ZODIAC[vpIdx].name;

  // Draw precession visualization
  drawPrecessCanvas(year, shiftMod);
}

function drawPrecessCanvas(year, shift){
  var canvas = document.getElementById('precessCanvas');
  var ctx = canvas.getContext('2d');
  var W = canvas.width, H = canvas.height;
  var cx = W/2, cy = H/2;
  var R = Math.min(W,H)/2 - 40;

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = '#050810';
  ctx.fillRect(0,0,W,H);

  // Draw zodiac wheel
  ZODIAC.forEach(function(z, i){
    var startAngle = (i * 30 - 90) * Math.PI / 180;
    var endAngle = ((i+1) * 30 - 90) * Math.PI / 180;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, R, startAngle, endAngle);
    ctx.closePath();
    ctx.fillStyle = z.color + '15';
    ctx.fill();
    ctx.strokeStyle = 'rgba(148,163,184,.15)';
    ctx.lineWidth = 0.5;
    ctx.stroke();

    // Label
    var midAngle = (startAngle + endAngle) / 2;
    var lx = cx + (R * 0.75) * Math.cos(midAngle);
    var ly = cy + (R * 0.75) * Math.sin(midAngle);
    ctx.font = '16px serif';
    ctx.fillStyle = z.color + '80';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(z.symbol, lx, ly);
  });

  // Draw vernal equinox arrow (shifts with precession)
  var vpAngle = (-shift - 90) * Math.PI / 180;
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + (R + 15) * Math.cos(vpAngle), cy + (R + 15) * Math.sin(vpAngle));
  ctx.strokeStyle = '#fbbf24';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Arrow head
  var ax = cx + (R + 15) * Math.cos(vpAngle);
  var ay = cy + (R + 15) * Math.sin(vpAngle);
  ctx.beginPath();
  ctx.arc(ax, ay, 4, 0, Math.PI*2);
  ctx.fillStyle = '#fbbf24';
  ctx.fill();

  // Label
  ctx.font = '10px "DM Sans"';
  ctx.fillStyle = '#fbbf24';
  ctx.textAlign = 'center';
  var lx2 = cx + (R + 28) * Math.cos(vpAngle);
  var ly2 = cy + (R + 28) * Math.sin(vpAngle);
  ctx.fillText('Lentepunt', lx2, ly2);

  // Center: Earth
  ctx.beginPath();
  ctx.arc(cx, cy, 12, 0, Math.PI*2);
  ctx.fillStyle = '#3b82f6';
  ctx.fill();
  ctx.font = '10px "Material Icons Round"';
  ctx.fillStyle = '#fff';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('\u2641', cx, cy); // Earth symbol

  // Year
  ctx.font = '700 12px "Space Mono"';
  ctx.fillStyle = 'rgba(148,163,184,.4)';
  ctx.fillText(year + ' n.Chr.', cx, cy + R + 35);
}

function buildShiftTable(){
  var html = '<thead><tr><th>Geboortedatum</th><th>Astrologie (tropisch)</th><th>Astronomie (siderisch)</th><th>Verschil?</th></tr></thead><tbody>';
  ZODIAC.forEach(function(z){
    var isDiff = z.tropisch !== z.siderisch;
    html += '<tr>';
    html += '<td>'+z.tropisch+'</td>';
    html += '<td><span style="font-size:16px">'+z.symbol+'</span> '+z.name+'</td>';
    // Find which sidereal sign this tropical range falls in
    // Simplification: show the sidereal sign for the middle of the tropical range
    var midMonth = z.tropStart[0];
    var midDay = z.tropStart[1] + 15;
    var testDate = new Date(2024, midMonth - 1, midDay);
    var sunLon = getSunEclipticLong(testDate);
    var sider = getSiderealSign(sunLon, 2024);
    html += '<td><span style="font-size:16px">'+sider.symbol+'</span> '+sider.name+'</td>';
    html += '<td>'+(z.name !== sider.name ? '<span class="shift-diff">\u2260 Verschilt!</span>' : '<span style="color:var(--green)">\u2713</span>')+'</td>';
    html += '</tr>';
  });
  html += '</tbody>';
  document.getElementById('shiftTable').innerHTML = html;
}

// ============================================================
// PLANETEN
// ============================================================
function planetNow(){
  var now = new Date();
  var offset = now.getTimezoneOffset();
  var local = new Date(now.getTime() - offset * 60000);
  document.getElementById('planetDate').value = local.toISOString().slice(0,16);
  updatePlanets();
}

function updatePlanets(){
  var val = document.getElementById('planetDate').value;
  var date = val ? new Date(val) : new Date();
  var observer = getObserver();

  var tbody = document.getElementById('planetTable').querySelector('tbody');
  var html = '';

  // Sun
  try {
    var sunEq = Astronomy.Equator('Sun', date, observer, true, true);
    var sunEcl = Astronomy.Ecliptic(sunEq.vec);
    var sunSign = getTropicalSign(sunEcl.elon);
    html += '<tr><td><span class="planet-dot" style="background:#fbbf24"></span>Zon</td>';
    html += '<td>'+sunSign.symbol+' '+sunSign.name+'</td>';
    html += '<td style="font:11px var(--mono)">'+sunEq.ra.toFixed(2)+'h</td>';
    html += '<td style="font:11px var(--mono)">'+sunEq.dec.toFixed(1)+'\u00b0</td>';
    html += '<td>\u2014</td></tr>';
  } catch(e){}

  // Moon
  try {
    var moonEq = Astronomy.Equator('Moon', date, observer, true, true);
    var moonEcl = Astronomy.Ecliptic(moonEq.vec);
    var moonSign = getTropicalSign(moonEcl.elon);
    html += '<tr><td><span class="planet-dot" style="background:#e2e8f0"></span>Maan</td>';
    html += '<td>'+moonSign.symbol+' '+moonSign.name+'</td>';
    html += '<td style="font:11px var(--mono)">'+moonEq.ra.toFixed(2)+'h</td>';
    html += '<td style="font:11px var(--mono)">'+moonEq.dec.toFixed(1)+'\u00b0</td>';
    html += '<td>\u2014</td></tr>';
  } catch(e){}

  // Planets
  PLANETS.forEach(function(pl){
    try {
      var eq = Astronomy.Equator(pl.body, date, observer, true, true);
      var ecl = Astronomy.Ecliptic(eq.vec);
      var sign = getTropicalSign(ecl.elon);
      var elong = Astronomy.Elongation(pl.body, date);

      // Retrograde check: compare ecliptic lon now vs 1 day later
      var datePlus = new Date(date.getTime() + 86400000);
      var eq2 = Astronomy.Equator(pl.body, datePlus, observer, true, true);
      var ecl2 = Astronomy.Ecliptic(eq2.vec);
      var dLon = ecl2.elon - ecl.elon;
      if(dLon > 180) dLon -= 360;
      if(dLon < -180) dLon += 360;
      var isRetro = dLon < 0;

      html += '<tr><td><span class="planet-dot" style="background:'+pl.color+'"></span>'+pl.name+'</td>';
      html += '<td>'+sign.symbol+' '+sign.name+'</td>';
      html += '<td style="font:11px var(--mono)">'+eq.ra.toFixed(2)+'h</td>';
      html += '<td style="font:11px var(--mono)">'+eq.dec.toFixed(1)+'\u00b0</td>';
      html += '<td>'+(isRetro ? '<span class="retro">\u211E RETRO</span>' : '<span style="color:var(--green);font:9px var(--mono)">DIRECT</span>')+'</td>';
      html += '</tr>';
    } catch(e){}
  });

  tbody.innerHTML = html;

  // Moon phase
  updateMoonPhase(date);

  // Events
  updateEvents(date, observer);
}

function updateMoonPhase(date){
  var phase = Astronomy.MoonPhase(date);
  var illum = Astronomy.Illumination('Moon', date);
  var phaseFrac = illum.phase_fraction;

  // Phase name
  var phaseName = 'Nieuwe maan';
  if(phase < 22.5) phaseName = 'Nieuwe maan';
  else if(phase < 67.5) phaseName = 'Wassende sikkel';
  else if(phase < 112.5) phaseName = 'Eerste kwartier';
  else if(phase < 157.5) phaseName = 'Wassende maan';
  else if(phase < 202.5) phaseName = 'Volle maan';
  else if(phase < 247.5) phaseName = 'Afnemende maan';
  else if(phase < 292.5) phaseName = 'Laatste kwartier';
  else if(phase < 337.5) phaseName = 'Afnemende sikkel';
  else phaseName = 'Nieuwe maan';

  var age = phase / 360 * 29.53;
  var pct = Math.round(phaseFrac * 100);

  document.getElementById('moonPhaseName').textContent = phaseName;
  document.getElementById('moonPhaseAge').textContent = 'Dag ' + age.toFixed(1) + ' van 29.5';
  document.getElementById('moonIllum').textContent = 'Verlicht: ' + pct + '%';

  // Draw moon
  var canvas = document.getElementById('moonCanvas');
  var ctx = canvas.getContext('2d');
  var W = canvas.width, H = canvas.height;
  var cx = W/2, cy = H/2, r = 40;

  ctx.clearRect(0,0,W,H);

  // Dark side
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI*2);
  ctx.fillStyle = '#1e293b';
  ctx.fill();

  // Illuminated side using phase angle
  ctx.save();
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI*2);
  ctx.clip();

  var phaseRad = phase * Math.PI / 180;
  // Calculate terminator position
  var k = Math.cos(phaseRad);

  ctx.beginPath();
  // Draw illuminated half
  if(phase <= 180){
    // Waxing: right side illuminated
    ctx.arc(cx, cy, r, -Math.PI/2, Math.PI/2, false);
    ctx.ellipse(cx, cy, Math.abs(k)*r, r, 0, Math.PI/2, -Math.PI/2, k > 0);
  } else {
    // Waning: left side illuminated
    ctx.arc(cx, cy, r, Math.PI/2, -Math.PI/2, false);
    ctx.ellipse(cx, cy, Math.abs(k)*r, r, 0, -Math.PI/2, Math.PI/2, k < 0);
  }
  ctx.fillStyle = '#e2e8f0';
  ctx.fill();
  ctx.restore();

  // Moon border
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI*2);
  ctx.strokeStyle = 'rgba(148,163,184,.2)';
  ctx.lineWidth = 1;
  ctx.stroke();
}

function updateEvents(date, observer){
  var html = '';
  var events = [];

  // Search for next full moon and new moon
  try {
    var nextFull = Astronomy.SearchMoonPhase(180, date, 30);
    if(nextFull) events.push({date:nextFull.date, label:'Volle maan', icon:'brightness_7', color:'var(--gold)'});
  } catch(e){}
  try {
    var nextNew = Astronomy.SearchMoonPhase(0, date, 30);
    if(nextNew) events.push({date:nextNew.date, label:'Nieuwe maan', icon:'brightness_3', color:'var(--tx3)'});
  } catch(e){}

  // Sunrise/sunset
  try {
    var rise = Astronomy.SearchRiseSet('Sun', observer, +1, date, 2);
    if(rise) events.push({date:rise.date, label:'Zonsopkomst', icon:'wb_sunny', color:'#fbbf24'});
    var set = Astronomy.SearchRiseSet('Sun', observer, -1, date, 2);
    if(set) events.push({date:set.date, label:'Zonsondergang', icon:'wb_twilight', color:'#f97316'});
  } catch(e){}

  // Sort by date
  events.sort(function(a,b){ return a.date - b.date; });

  events.forEach(function(ev){
    var d = ev.date;
    html += '<div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.03)">';
    html += '<span class="mi" style="font-size:16px;color:'+ev.color+'">'+ev.icon+'</span>';
    html += '<div style="flex:1"><div style="font:500 12px var(--font)">'+ev.label+'</div>';
    html += '<div style="font:10px var(--mono);color:var(--tx3)">'+d.toLocaleString('nl-NL',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'})+'</div>';
    html += '</div></div>';
  });

  document.getElementById('eventsList').innerHTML = html || '<div style="color:var(--tx3);font-size:11px">Geen gebeurtenissen gevonden</div>';
}

// ============================================================
// ASCENDANT CALCULATION
// ============================================================
function calcAscendant(date, lat, lon){
  // Calculate Local Sidereal Time
  var jd = getJulianDate(date);
  var T = (jd - 2451545.0) / 36525.0;
  // Greenwich Mean Sidereal Time in degrees
  var GMST = 280.46061837 + 360.98564736629 * (jd - 2451545.0)
             + 0.000387933 * T * T - T * T * T / 38710000.0;
  GMST = ((GMST % 360) + 360) % 360;
  // Local Sidereal Time
  var LST = ((GMST + lon) % 360 + 360) % 360;
  var RAMC = LST; // Right Ascension of Medium Coeli in degrees

  // Obliquity of ecliptic
  var obliquity = 23.4393 - 0.0130 * T; // simplified
  var oblRad = obliquity * Math.PI / 180;
  var latRad = lat * Math.PI / 180;
  var ramcRad = RAMC * Math.PI / 180;

  // Ascendant formula
  var ascRad = Math.atan2(-Math.cos(ramcRad),
    Math.sin(ramcRad) * Math.cos(oblRad) + Math.tan(latRad) * Math.sin(oblRad));
  var ascDeg = ascRad * 180 / Math.PI;
  ascDeg = ((ascDeg % 360) + 360) % 360;

  // Find zodiac sign
  var signIdx = Math.floor(ascDeg / 30) % 12;
  var degInSign = ascDeg % 30;
  return {longitude: ascDeg, sign: ZODIAC[signIdx], degInSign: degInSign, mc: RAMC};
}

function getJulianDate(date){
  var y = date.getUTCFullYear();
  var m = date.getUTCMonth() + 1;
  var d = date.getUTCDate() + date.getUTCHours()/24 + date.getUTCMinutes()/1440 + date.getUTCSeconds()/86400;
  if(m <= 2){ y--; m += 12; }
  var A = Math.floor(y / 100);
  var B = 2 - A + Math.floor(A / 4);
  return Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + d + B - 1524.5;
}

// ============================================================
// NATAL CHART WHEEL
// ============================================================
function drawNatalChart(ascLon, mcLon, planetPositions, sunLon){
  var canvas = document.getElementById('natalChartCanvas');
  var ctx = canvas.getContext('2d');
  var W = canvas.width, H = canvas.height;
  var cx = W/2, cy = H/2;
  var R = Math.min(W,H)/2 - 30;
  var R2 = R * 0.82;
  var R3 = R * 0.65;

  ctx.clearRect(0,0,W,H);

  // Background
  var bgGrad = ctx.createRadialGradient(cx,cy,0,cx,cy,R+20);
  bgGrad.addColorStop(0,'#0a1025');
  bgGrad.addColorStop(1,'#050810');
  ctx.fillStyle = bgGrad;
  ctx.fillRect(0,0,W,H);

  // Rotation: ASC should be at the left (180°/9 o'clock position)
  var ascOffset = -ascLon - 180;

  // Draw zodiac segments (outer ring)
  ZODIAC.forEach(function(z, i){
    var startDeg = i * 30 + ascOffset;
    var endDeg = (i + 1) * 30 + ascOffset;
    var startRad = startDeg * Math.PI / 180;
    var endRad = endDeg * Math.PI / 180;

    // Colored segment
    ctx.beginPath();
    ctx.arc(cx, cy, R, startRad, endRad);
    ctx.arc(cx, cy, R2, endRad, startRad, true);
    ctx.closePath();
    ctx.fillStyle = z.color + '20';
    ctx.fill();
    ctx.strokeStyle = 'rgba(148,163,184,.12)';
    ctx.lineWidth = 0.5;
    ctx.stroke();

    // Zodiac symbol
    var midRad = (startRad + endRad) / 2;
    var symR = (R + R2) / 2;
    var sx = cx + symR * Math.cos(midRad);
    var sy = cy + symR * Math.sin(midRad);
    ctx.font = '18px serif';
    ctx.fillStyle = z.color + 'cc';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(z.symbol, sx, sy);
  });

  // House lines (equal houses from ASC)
  for(var h = 0; h < 12; h++){
    var hDeg = h * 30 + ascOffset;
    var hRad = hDeg * Math.PI / 180;
    ctx.beginPath();
    ctx.moveTo(cx + R2 * Math.cos(hRad), cy + R2 * Math.sin(hRad));
    ctx.lineTo(cx + R3 * Math.cos(hRad), cy + R3 * Math.sin(hRad));
    ctx.strokeStyle = 'rgba(148,163,184,.15)';
    ctx.lineWidth = 0.5;
    ctx.stroke();

    // House number
    var hnRad = (h * 30 + 15 + ascOffset) * Math.PI / 180;
    var hnR = (R2 + R3) / 2;
    ctx.font = '9px "Space Mono"';
    ctx.fillStyle = 'rgba(148,163,184,.3)';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(h + 1, cx + hnR * Math.cos(hnRad), cy + hnR * Math.sin(hnRad));
  }

  // Inner circle
  ctx.beginPath();
  ctx.arc(cx, cy, R3, 0, Math.PI*2);
  ctx.strokeStyle = 'rgba(148,163,184,.1)';
  ctx.lineWidth = 0.5;
  ctx.stroke();

  // ASC line (left, horizontal)
  var ascRad = (ascOffset + ascLon) * Math.PI / 180;
  // ASC is always at 180° (left) by our rotation
  ctx.beginPath();
  ctx.moveTo(cx - R - 10, cy);
  ctx.lineTo(cx + R + 10, cy);
  ctx.strokeStyle = 'rgba(251,191,36,.4)';
  ctx.lineWidth = 1.5;
  ctx.setLineDash([4,4]);
  ctx.stroke();
  ctx.setLineDash([]);

  // ASC label
  ctx.font = '700 11px "DM Sans"';
  ctx.fillStyle = '#fbbf24';
  ctx.textAlign = 'right';
  ctx.fillText('ASC', cx - R - 14, cy - 5);

  // MC line (top)
  var mcDeg = (mcLon + ascOffset) * Math.PI / 180;
  ctx.beginPath();
  ctx.moveTo(cx + (R+10) * Math.cos(mcDeg), cy + (R+10) * Math.sin(mcDeg));
  ctx.lineTo(cx - (R+10) * Math.cos(mcDeg), cy - (R+10) * Math.sin(mcDeg));
  ctx.strokeStyle = 'rgba(168,85,247,.3)';
  ctx.lineWidth = 1;
  ctx.setLineDash([3,3]);
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.font = '700 10px "DM Sans"';
  ctx.fillStyle = '#a855f7';
  ctx.textAlign = 'center';
  ctx.fillText('MC', cx + (R+18) * Math.cos(mcDeg), cy + (R+18) * Math.sin(mcDeg));

  // Plot planets
  var planetR = R3 * 0.75;
  var plotted = [];
  planetPositions.forEach(function(pp){
    var pDeg = pp.lon + ascOffset;
    var pRad = pDeg * Math.PI / 180;

    // Avoid overlap: nudge if too close to another planet
    var px = cx + planetR * Math.cos(pRad);
    var py = cy + planetR * Math.sin(pRad);
    for(var pi = 0; pi < plotted.length; pi++){
      var dx = px - plotted[pi].x, dy = py - plotted[pi].y;
      if(Math.sqrt(dx*dx + dy*dy) < 20){
        planetR *= 0.88;
        px = cx + planetR * Math.cos(pRad);
        py = cy + planetR * Math.sin(pRad);
      }
    }
    plotted.push({x:px, y:py});

    // Line from outer ring to planet
    ctx.beginPath();
    ctx.moveTo(cx + R2 * Math.cos(pRad), cy + R2 * Math.sin(pRad));
    ctx.lineTo(px, py);
    ctx.strokeStyle = pp.color + '40';
    ctx.lineWidth = 0.5;
    ctx.stroke();

    // Planet dot
    var glow = ctx.createRadialGradient(px, py, 0, px, py, 10);
    glow.addColorStop(0, pp.color + '60');
    glow.addColorStop(1, pp.color + '00');
    ctx.fillStyle = glow;
    ctx.fillRect(px-10, py-10, 20, 20);

    ctx.beginPath();
    ctx.arc(px, py, 4, 0, Math.PI*2);
    ctx.fillStyle = pp.color;
    ctx.fill();

    // Label
    ctx.font = '500 8px "DM Sans"';
    ctx.fillStyle = pp.color;
    ctx.textAlign = 'center';
    ctx.fillText(pp.name.substring(0,3), px, py - 8);

    planetR = R3 * 0.75; // reset
  });

  // Sun marker (special)
  var sunDeg = sunLon + ascOffset;
  var sunRad = sunDeg * Math.PI / 180;
  var sunX = cx + R2 * Math.cos(sunRad);
  var sunY = cy + R2 * Math.sin(sunRad);
  var sunGlow = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, 12);
  sunGlow.addColorStop(0, 'rgba(251,191,36,.5)');
  sunGlow.addColorStop(1, 'rgba(251,191,36,0)');
  ctx.fillStyle = sunGlow;
  ctx.fillRect(sunX-12, sunY-12, 24, 24);
  ctx.beginPath();
  ctx.arc(sunX, sunY, 5, 0, Math.PI*2);
  ctx.fillStyle = '#fbbf24';
  ctx.fill();
  ctx.font = '700 8px "DM Sans"';
  ctx.fillStyle = '#fbbf24';
  ctx.textAlign = 'center';
  ctx.fillText('\u2609', sunX, sunY - 9);

  // Center label
  ctx.font = '10px "DM Sans"';
  ctx.fillStyle = 'rgba(148,163,184,.3)';
  ctx.textAlign = 'center';
  ctx.fillText('Geboortekaart', cx, cy);
}

// ============================================================
// STAR CHART TOOLTIPS
// ============================================================
function setupStarTooltips(){
  var canvas = document.getElementById('skyCanvas');
  var tooltip = document.getElementById('starTooltip');

  canvas.addEventListener('mousemove', function(e){
    var rect = canvas.getBoundingClientRect();
    var scaleX = canvas.width / rect.width;
    var scaleY = canvas.height / rect.height;
    var mx = (e.clientX - rect.left) * scaleX;
    var my = (e.clientY - rect.top) * scaleY;

    var closest = null;
    var closestDist = 20; // pixel threshold

    // Check stars
    for(var i = 0; i < _renderedStars.length; i++){
      var s = _renderedStars[i];
      var dx = mx - s.x, dy = my - s.y;
      var d = Math.sqrt(dx*dx + dy*dy);
      if(d < closestDist){
        closestDist = d;
        closest = {type:'star', data:s};
      }
    }
    // Check planets
    for(var j = 0; j < _renderedPlanets.length; j++){
      var p = _renderedPlanets[j];
      var dx2 = mx - p.x, dy2 = my - p.y;
      var d2 = Math.sqrt(dx2*dx2 + dy2*dy2);
      if(d2 < closestDist){
        closestDist = d2;
        closest = {type:'planet', data:p};
      }
    }
    // Check deep sky objects
    for(var k = 0; k < _renderedDeepSky.length; k++){
      var ds = _renderedDeepSky[k];
      var dx3 = mx - ds.x, dy3 = my - ds.y;
      var d3 = Math.sqrt(dx3*dx3 + dy3*dy3);
      if(d3 < 25){ // bigger hit area for deep sky
        closestDist = d3;
        closest = {type:'deepsky', data:ds};
      }
    }

    if(closest){
      var html = '';
      if(closest.type === 'star'){
        var info = STAR_FACTS[closest.data.name];
        html = '<div class="tt-name">\u2b50 ' + closest.data.name + '</div>';
        if(info){
          html += '<div class="tt-type">' + info.spectral + ' \u00b7 ' + info.constellation + '</div>';
          html += '<div class="tt-stats">';
          html += '<span class="tt-stat-label">Afstand</span><span class="tt-stat-val">' + info.dist + '</span>';
          html += '<span class="tt-stat-label">Helderheid</span><span class="tt-stat-val">mag ' + closest.data.mag.toFixed(2) + '</span>';
          html += '<span class="tt-stat-label">Spectraaltype</span><span class="tt-stat-val">' + info.spectral + '</span>';
          html += '</div>';
          html += '<div class="tt-divider"></div>';
          html += '<div class="tt-fact">\ud83d\udca1 ' + info.fact + '</div>';
        } else {
          html += '<div class="tt-stats">';
          html += '<span class="tt-stat-label">Helderheid</span><span class="tt-stat-val">mag ' + closest.data.mag.toFixed(2) + '</span>';
          html += '<span class="tt-stat-label">Hoogte</span><span class="tt-stat-val">' + closest.data.alt.toFixed(1) + '\u00b0</span>';
          html += '<span class="tt-stat-label">Azimut</span><span class="tt-stat-val">' + closest.data.az.toFixed(1) + '\u00b0</span>';
          html += '</div>';
        }
      } else if(closest.type === 'planet'){
        var pf = PLANET_FACTS[closest.data.name];
        html = '<div class="tt-name" style="color:'+closest.data.color+'">';
        if(closest.data.name === 'Zon') html += '\u2609 ';
        else if(closest.data.name === 'Maan') html += '\u263d ';
        else html += '\ud83c\udf0d ';
        html += closest.data.name + '</div>';
        if(pf){
          html += '<div class="tt-type">' + pf.type + '</div>';
          html += '<div class="tt-stats">';
          html += '<span class="tt-stat-label">Diameter</span><span class="tt-stat-val">' + pf.diameter + '</span>';
          html += '<span class="tt-stat-label">Afstand</span><span class="tt-stat-val">' + pf.dist + '</span>';
          html += '<span class="tt-stat-label">Temperatuur</span><span class="tt-stat-val">' + pf.temp + '</span>';
          if(pf.manen !== '\u2014') html += '<span class="tt-stat-label">Manen</span><span class="tt-stat-val">' + pf.manen + '</span>';
          html += '<span class="tt-stat-label">Hoogte</span><span class="tt-stat-val">' + closest.data.alt.toFixed(1) + '\u00b0</span>';
          html += '<span class="tt-stat-label">Azimut</span><span class="tt-stat-val">' + closest.data.az.toFixed(1) + '\u00b0</span>';
          html += '</div>';
          html += '<div class="tt-divider"></div>';
          // Random fact
          var randomFact = pf.facts[Math.floor(Math.random() * pf.facts.length)];
          html += '<div class="tt-fact">\ud83d\udca1 ' + randomFact + '</div>';
        } else {
          html += '<div class="tt-stats">';
          html += '<span class="tt-stat-label">Hoogte</span><span class="tt-stat-val">' + closest.data.alt.toFixed(1) + '\u00b0</span>';
          html += '<span class="tt-stat-label">Azimut</span><span class="tt-stat-val">' + closest.data.az.toFixed(1) + '\u00b0</span>';
          html += '</div>';
        }
      } else if(closest.type === 'deepsky'){
        var dsf = DEEP_SKY_FACTS[closest.data.name];
        var typeIcons = {blackhole:'\ud83d\udd73\ufe0f', nebula:'\ud83c\udf0c', galaxy:'\ud83c\udf0c', cluster:'\u2728'};
        var typeColors = {blackhole:'#a855f7', nebula:'#ec4899', galaxy:'#3b82f6', cluster:'#60a5fa'};
        var typeLabels = {blackhole:'Zwart gat', nebula:'Nevel', galaxy:'Sterrenstelsel', cluster:'Sterrenhoop'};
        var dsColor = typeColors[closest.data.type] || '#a855f7';

        html = '<div class="tt-name" style="color:'+dsColor+'">'+(typeIcons[closest.data.type]||'')+' '+closest.data.name+'</div>';
        if(dsf){
          html += '<div class="tt-type">'+dsf.type+'</div>';
          html += '<div class="tt-stats">';
          html += '<span class="tt-stat-label">Afstand</span><span class="tt-stat-val">'+dsf.dist+'</span>';
          if(dsf.mass) html += '<span class="tt-stat-label">Massa</span><span class="tt-stat-val">'+dsf.mass+'</span>';
          if(dsf.size) html += '<span class="tt-stat-label">Grootte</span><span class="tt-stat-val">'+dsf.size+'</span>';
          html += '<span class="tt-stat-label">Hoogte</span><span class="tt-stat-val">'+closest.data.alt.toFixed(1)+'\u00b0</span>';
          html += '<span class="tt-stat-label">Azimut</span><span class="tt-stat-val">'+closest.data.az.toFixed(1)+'\u00b0</span>';
          html += '</div>';
          html += '<div class="tt-divider"></div>';
          var dsFact = dsf.facts[Math.floor(Math.random() * dsf.facts.length)];
          html += '<div class="tt-fact">\ud83d\udca1 '+dsFact+'</div>';
        } else {
          html += '<div class="tt-type">'+typeLabels[closest.data.type]+'</div>';
        }
      }
      tooltip.innerHTML = html;
      tooltip.classList.add('visible');
      // Position
      var tx = e.clientX + 16;
      var ty = e.clientY - 10;
      if(tx + 320 > window.innerWidth) tx = e.clientX - 330;
      if(ty + 200 > window.innerHeight) ty = e.clientY - 210;
      tooltip.style.left = tx + 'px';
      tooltip.style.top = ty + 'px';
    } else {
      tooltip.classList.remove('visible');
    }
  });

  canvas.addEventListener('mouseleave', function(){
    tooltip.classList.remove('visible');
  });
}

// ============================================================
// COMPATIBILITY
// ============================================================
function getCompatibilityScore(sign1, sign2){
  if(sign1.id === sign2.id) return {score:3, label:'Goed', reason:'Zelfde teken \u2014 jullie begrijpen elkaars kracht en zwakte.'};
  if(sign1.bestMatch === sign2.id) return {score:5, label:'Perfect', reason:'Jullie elementen versterken elkaar en maken een onverslaanbaar duo!'};
  if(sign1.compatible.indexOf(sign2.id) >= 0) return {score:4, label:'Heel goed', reason:'Harmonieuze combinatie van elementen en energie.'};
  // Same element = good
  if(sign1.element === sign2.element) return {score:4, label:'Heel goed', reason:'Zelfde element ('+sign1.element+') \u2014 jullie spreken dezelfde taal.'};
  // Complementary elements
  var comp = {'Vuur':'Lucht','Lucht':'Vuur','Aarde':'Water','Water':'Aarde'};
  if(comp[sign1.element] === sign2.element) return {score:3, label:'Goed', reason:sign1.element+' en '+sign2.element+' voeden elkaar.'};
  // Challenging
  return {score:2, label:'Uitdagend', reason:'Verschillende elementen ('+sign1.element+' vs '+sign2.element+') \u2014 kan groeien door contrast.'};
}

function buildCompatibilityHTML(sunSign, ascSign){
  var html = '<h3 style="color:var(--cyan)">\u2764\ufe0f Compatibiliteit</h3>';
  html += '<p style="font-size:11px;color:var(--tx2);margin-bottom:8px">Op basis van jouw zonteken ('+sunSign.name+') en ascendant ('+ascSign.name+'):</p>';
  html += '<div class="compat-grid">';

  ZODIAC.forEach(function(z){
    var sunCompat = getCompatibilityScore(sunSign, z);
    var ascCompat = getCompatibilityScore(ascSign, z);
    var avg = (sunCompat.score + ascCompat.score) / 2;
    var stars = '';
    for(var s = 0; s < 5; s++) stars += s < Math.round(avg) ? '\u2605' : '\u2606';
    var isBest = avg >= 4.5;

    html += '<div class="compat-card'+(isBest?' best':'')+'">';
    html += '<div class="compat-symbol">'+z.symbol+'</div>';
    html += '<div class="compat-name">'+z.name+'</div>';
    html += '<div class="compat-stars">'+stars+'</div>';
    html += '<div style="font:9px var(--mono);color:var(--tx3);margin-top:2px">'+sunCompat.label+'</div>';
    html += '</div>';
  });
  html += '</div>';

  // Best matches detail
  var bestMatches = [];
  ZODIAC.forEach(function(z){
    var sc = getCompatibilityScore(sunSign, z);
    var ac = getCompatibilityScore(ascSign, z);
    bestMatches.push({sign:z, score:(sc.score+ac.score)/2, sunReason:sc.reason, ascReason:ac.reason});
  });
  bestMatches.sort(function(a,b){ return b.score - a.score; });

  html += '<div style="margin-top:12px">';
  html += '<h3 style="color:var(--green)">Top 3 Beste Matches</h3>';
  bestMatches.slice(0,3).forEach(function(m, i){
    var medal = ['\ud83e\udd47','\ud83e\udd48','\ud83e\udd49'][i];
    html += '<div style="display:flex;gap:10px;align-items:center;padding:8px;background:var(--glass);border:1px solid var(--glass-bd);border-radius:var(--rs);margin-bottom:6px">';
    html += '<span style="font-size:20px">'+medal+'</span>';
    html += '<span style="font-size:22px">'+m.sign.symbol+'</span>';
    html += '<div style="flex:1"><div style="font:600 12px var(--font)">'+m.sign.name+'</div>';
    html += '<div style="font:10px var(--font);color:var(--tx2)">'+m.sunReason+'</div></div>';
    html += '</div>';
  });
  html += '</div>';

  return html;
}

// ============================================================
// INIT
// ============================================================
(function init(){
  skyNow();
  buildZodiacGrid();
  buildShiftTable();
  updatePrecess();
  setupStarTooltips();
  startSkyAnimation();
})();
</script>
</body>
</html>
